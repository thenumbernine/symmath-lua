<!doctype html>
<html>
	<head>
		<meta charset='utf-8'>
		<title>tests/unit/nonassociative</title>
		<script type='text/javascript' src='../tryToFindMathJax.js'></script>
	
		<style>
:root {
	--font-color: #000000;
	--bg-color: rgb(243,243,243);
}
[data-theme="dark"] {
	--font-color: #ffffff;
	--bg-color: #000000;
}

body {
	overflow : scroll;
	background : var(--bg-color);
	color : var(--font-color);
}

/* desktop chrome inputs have white background black font.  mobile chrome inputs have clear background black font. */
input {
	background : var(--bg-color);
	color : var(--font-color);
}
		</style>
		<script type='text/javascript'>
//https://stackoverflow.com/questions/56300132/how-to-override-css-prefers-color-scheme-setting
//window.addEventListener('load', () => 
{
	let darkMode = false;
	if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
		darkMode = true;
	}
	if (darkMode) {
		document.documentElement.setAttribute('data-theme', 'dark');
	} else {
		document.documentElement.removeAttribute('data-theme', 'dark');
	}
}
//);
		</script>


	</head>
	<body>

<table border="1" style="border-collapse:collapse">
<tr><td>
<b></b><br>
<code>simplifyAssertEq(e0 * e0, e0)</code>
</td><td>
${{{{e_{0}}}} {{{e_{0}}}}} = {{e_{0}}}$
<br>

<span style="color:green">GOOD</span>
</td><td>
time: 0.954000ms<br>
stack: size: 7<br><ul style="margin:0px"><li>Init<br><li>Prune<br><li>Expand<br><li>Prune<br><li>Factor<br><li>Prune<br><li>Tidy</ul>
</td></tr>
<tr><td>
<b></b><br>
<code>simplifyAssertEq(e1 * e1, -e0)</code>
</td><td>
${{{{e_{1}}}} {{{e_{1}}}}} = {-{{e_{0}}}}$
<br>

<span style="color:green">GOOD</span>
</td><td>
time: 2.222000ms<br>
stack: size: 11<br><ul style="margin:0px"><li>Init<br><li>unm:Prune:doubleNegative<br><li>Prune<br><li>Expand<br><li>Prune<br><li>Factor<br><li>Prune<br><li>Constant:Tidy:apply<br><li>*:Tidy:apply<br><li>*:Tidy:apply<br><li>Tidy</ul>
</td></tr>
<tr><td>
<b></b><br>
<code>simplifyAssertEq(e1 * e2, e3)</code>
</td><td>
${{{{e_{1}}}} {{{e_{2}}}}} = {{e_{3}}}$
<br>

<span style="color:green">GOOD</span>
</td><td>
time: 0.889000ms<br>
stack: size: 7<br><ul style="margin:0px"><li>Init<br><li>Prune<br><li>Expand<br><li>Prune<br><li>Factor<br><li>Prune<br><li>Tidy</ul>
</td></tr>
<tr><td>
<b></b><br>
<code>simplifyAssertEq(e2 * e1, -e3)</code>
</td><td>
${{{{e_{2}}}} {{{e_{1}}}}} = {-{{e_{3}}}}$
<br>

<span style="color:green">GOOD</span>
</td><td>
time: 2.695000ms<br>
stack: size: 11<br><ul style="margin:0px"><li>Init<br><li>unm:Prune:doubleNegative<br><li>Prune<br><li>Expand<br><li>Prune<br><li>Factor<br><li>Prune<br><li>Constant:Tidy:apply<br><li>*:Tidy:apply<br><li>*:Tidy:apply<br><li>Tidy</ul>
</td></tr>
<tr><td>
<b>zero-associator</b><br>
<code>simplifyAssertEq((e1 * e2) * e3, -e0)</code>
</td><td>
${{{{{{e_{1}}}} {{{e_{2}}}}}} {{{e_{3}}}}} = {-{{e_{0}}}}$
<br>

<span style="color:green">GOOD</span>
</td><td>
time: 1.592000ms<br>
stack: size: 11<br><ul style="margin:0px"><li>Init<br><li>unm:Prune:doubleNegative<br><li>Prune<br><li>Expand<br><li>Prune<br><li>Factor<br><li>Prune<br><li>Constant:Tidy:apply<br><li>*:Tidy:apply<br><li>*:Tidy:apply<br><li>Tidy</ul>
</td></tr>
<tr><td>
<b></b><br>
<code>simplifyAssertEq(e1 * (e2 * e3), -e0)</code>
</td><td>
${{{{e_{1}}}} {{{{{e_{2}}}} {{{e_{3}}}}}}} = {-{{e_{0}}}}$
<br>

<span style="color:green">GOOD</span>
</td><td>
time: 1.105000ms<br>
stack: size: 11<br><ul style="margin:0px"><li>Init<br><li>unm:Prune:doubleNegative<br><li>Prune<br><li>Expand<br><li>Prune<br><li>Factor<br><li>Prune<br><li>Constant:Tidy:apply<br><li>*:Tidy:apply<br><li>*:Tidy:apply<br><li>Tidy</ul>
</td></tr>
<tr><td>
<b>nonzero associator</b><br>
<code>simplifyAssertEq((e1 * e2) * e4, e7)</code>
</td><td>
${{{{{{e_{1}}}} {{{e_{2}}}}}} {{{e_{4}}}}} = {{e_{7}}}$
<br>

<span style="color:green">GOOD</span>
</td><td>
time: 0.335000ms<br>
stack: size: 7<br><ul style="margin:0px"><li>Init<br><li>Prune<br><li>Expand<br><li>Prune<br><li>Factor<br><li>Prune<br><li>Tidy</ul>
</td></tr>
<tr><td>
<b></b><br>
<code>simplifyAssertEq(e1 * (e2 * e4), -e7)</code>
</td><td>
${{{{e_{1}}}} {{{{{e_{2}}}} {{{e_{4}}}}}}} = {-{{e_{7}}}}$
<br>

<span style="color:green">GOOD</span>
</td><td>
time: 1.248000ms<br>
stack: size: 11<br><ul style="margin:0px"><li>Init<br><li>unm:Prune:doubleNegative<br><li>Prune<br><li>Expand<br><li>Prune<br><li>Factor<br><li>Prune<br><li>Constant:Tidy:apply<br><li>*:Tidy:apply<br><li>*:Tidy:apply<br><li>Tidy</ul>
</td></tr>
<tr><td>
<b>with coefficients:</b><br>
<code>simplifyAssertEq((var'a' * e1 * e2) * e4, var'a' * e7)</code>
</td><td>
${{{a}} {{{{a}} {{{e_{1}}}} {{{e_{2}}}}}} {{{e_{4}}}}} = {{{a}} {{{e_{7}}}}}$
<br>
expected ${{a}} {{{{a}} {{{e_{1}}}} {{{e_{2}}}}}} {{{e_{4}}}}$ to equal ${{a}} {{{e_{7}}}}$<br>
found ${{{a}^{2}}} {{{e_{7}}}}$ vs ${{a}} {{{e_{7}}}}$<br>
lhs stack<br>
Init	${{a}} {{{{a}} {{{e_{1}}}} {{{e_{2}}}}}} {{{e_{4}}}}$	<pre>	*[a, *[a, CayleyDicksonBasis{1}, CayleyDicksonBasis{2}], CayleyDicksonBasis{4}]	</pre>
<br>
*:Prune:pruneCayleyDicksonMul	${{a}} {{{e_{3}}}}$	<pre>	*[a, CayleyDicksonBasis{3}]	</pre>
<br>
+:Prune:combineConstants	$2$	<pre>	2	</pre>
<br>
*:Prune:pruneCayleyDicksonMul	${{{a}^{2}}} {{{e_{7}}}}$	<pre>	*[^[a, 2], CayleyDicksonBasis{7}]	</pre>
<br>
*:Prune:combinePows	${{{a}^{2}}} {{{e_{7}}}}$	<pre>	*[^[a, 2], CayleyDicksonBasis{7}]	</pre>
<br>
*:Prune:flatten	${{{a}^{2}}} {{{e_{7}}}}$	<pre>	*[^[a, 2], CayleyDicksonBasis{7}]	</pre>
<br>
Prune	${{{a}^{2}}} {{{e_{7}}}}$	<pre>	*[^[a, 2], CayleyDicksonBasis{7}]	</pre>
<br>
^:Expand:integerPower	${{a}} {{a}}$	<pre>	*[a, a]	</pre>
<br>
Expand	${{{{a}} {{a}}}} {{{e_{7}}}}$	<pre>	*[*[a, a], CayleyDicksonBasis{7}]	</pre>
<br>
+:Prune:combineConstants	$2$	<pre>	2	</pre>
<br>
*:Prune:combinePows	${a}^{2}$	<pre>	^[a, 2]	</pre>
<br>
Prune	${{{a}^{2}}} {{{e_{7}}}}$	<pre>	*[^[a, 2], CayleyDicksonBasis{7}]	</pre>
<br>
Factor	${{{a}^{2}}} {{{e_{7}}}}$	<pre>	*[^[a, 2], CayleyDicksonBasis{7}]	</pre>
<br>
Prune	${{{a}^{2}}} {{{e_{7}}}}$	<pre>	*[^[a, 2], CayleyDicksonBasis{7}]	</pre>
<br>
*:Tidy:apply	${{{a}^{2}}} {{{e_{7}}}}$	<pre>	*[^[a, 2], CayleyDicksonBasis{7}]	</pre>
<br>
Tidy	${{{a}^{2}}} {{{e_{7}}}}$	<pre>	*[^[a, 2], CayleyDicksonBasis{7}]	</pre>
<br>
rhs stack<br>
Init	${{a}} {{{e_{7}}}}$	<pre>	*[a, CayleyDicksonBasis{7}]	</pre>
<br>
Prune	${{a}} {{{e_{7}}}}$	<pre>	*[a, CayleyDicksonBasis{7}]	</pre>
<br>
Expand	${{a}} {{{e_{7}}}}$	<pre>	*[a, CayleyDicksonBasis{7}]	</pre>
<br>
Prune	${{a}} {{{e_{7}}}}$	<pre>	*[a, CayleyDicksonBasis{7}]	</pre>
<br>
Factor	${{a}} {{{e_{7}}}}$	<pre>	*[a, CayleyDicksonBasis{7}]	</pre>
<br>
Prune	${{a}} {{{e_{7}}}}$	<pre>	*[a, CayleyDicksonBasis{7}]	</pre>
<br>
*:Tidy:apply	${{a}} {{{e_{7}}}}$	<pre>	*[a, CayleyDicksonBasis{7}]	</pre>
<br>
Tidy	${{a}} {{{e_{7}}}}$	<pre>	*[a, CayleyDicksonBasis{7}]	</pre>
<br>
<span style="color:red">BAD</span><br>/home/chris/Projects/lua/symmath/tests/unit/unit.lua:136: failed<br>
stack traceback:<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:257: in function </home/chris/Projects/lua/symmath/tests/unit/unit.lua:256><br>
	[C]: in function 'error'<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:136: in function 'simplifyAssertEq'<br>
	[string "simplifyAssertEq((var'a' * e1 * e2) * e4, var..."]:1: in main chunk<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:249: in function </home/chris/Projects/lua/symmath/tests/unit/unit.lua:248><br>
	[C]: in function 'xpcall'<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:248: in function 'exec'<br>
	./nonassociative.lua:56: in function 'cb'<br>
	[string "/home/chris/Projects/lua/ext/timer.lua"]:101: in function 'timer'<br>
	./nonassociative.lua:10: in main chunk<br>
	[C]: at 0x6338ce683390
</td><td>
time: 3.233000ms<br>
stack: size: 8<br><ul style="margin:0px"><li>Init<br><li>Prune<br><li>Expand<br><li>Prune<br><li>Factor<br><li>Prune<br><li>*:Tidy:apply<br><li>Tidy</ul>
</td></tr>
<tr><td>
<b>should equal -e1 - e2</b><br>
<code>print((((e1 + e2) * e2) * e2)())</code>
</td><td>
<span style="color:red">BAD</span><br>stack overflow<br>
stack traceback:<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:257: in function </home/chris/Projects/lua/symmath/tests/unit/unit.lua:256><br>
	[C]: in function 'match'<br>
	[string "/home/chris/Projects/lua/symmath/Expression.lua"]:107: in function 'shallowCopy'<br>
	[string "/home/chris/Projects/lua/symmath/visitor/Visi..."]:114: in function 'apply'<br>
	[string "/home/chris/Projects/lua/symmath/visitor/Visi..."]:183: in function 'apply'<br>
	[string "/home/chris/Projects/lua/symmath/visitor/Visi..."]:183: in function 'apply'<br>
	[string "/home/chris/Projects/lua/symmath/visitor/Visi..."]:183: in function 'func'<br>
	[string "/home/chris/Projects/lua/symmath/visitor/Visi..."]:224: in function 'func'<br>
	[string "/home/chris/Projects/lua/symmath/visitor/Visi..."]:224: in function 'func'<br>
	[string "/home/chris/Projects/lua/symmath/visitor/Visi..."]:224: in function 'func'<br>
	[string "/home/chris/Projects/lua/symmath/visitor/Visi..."]:224: in function 'func'<br>
	...<br>
	[string "/home/chris/Projects/lua/symmath/visitor/Visi..."]:224: in function 'prune'<br>
	[string "/home/chris/Projects/lua/symmath/simplify.lua"]:179: in function <[string "/home/chris/Projects/lua/symmath/simplify.lua"]:131><br>
	[string "print((((e1 + e2) * e2) * e2)())"]:1: in main chunk<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:249: in function </home/chris/Projects/lua/symmath/tests/unit/unit.lua:248><br>
	[C]: in function 'xpcall'<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:248: in function 'exec'<br>
	./nonassociative.lua:56: in function 'cb'<br>
	[string "/home/chris/Projects/lua/ext/timer.lua"]:101: in function 'timer'<br>
	./nonassociative.lua:10: in main chunk<br>
	[C]: at 0x6338ce683390
</td><td>
time: 144.289000ms<br>
stack: size: 1<br><ul style="margin:0px"><li>Init</ul>
</td></tr>
<tr><td>
<b></b><br>
<code>assert.eq(true, Expression.__eq((2 * e0)(), 2 * e0))</code>
</td><td>

<span style="color:green">GOOD</span>
</td><td>
time: 0.444000ms<br>
stack: size: 8<br><ul style="margin:0px"><li>Init<br><li>Prune<br><li>Expand<br><li>Prune<br><li>Factor<br><li>Prune<br><li>*:Tidy:apply<br><li>Tidy</ul>
</td></tr>
<tr><td>
<b></b><br>
<code>assert.eq(false, Expression.__eq((2 * e0)(), e0 * 2))</code>
</td><td>

<span style="color:green">GOOD</span>
</td><td>
time: 0.381000ms<br>
stack: size: 8<br><ul style="margin:0px"><li>Init<br><li>Prune<br><li>Expand<br><li>Prune<br><li>Factor<br><li>Prune<br><li>*:Tidy:apply<br><li>Tidy</ul>
</td></tr>
<tr><td>
<b></b><br>
<code>assert.eq(true, Expression.__eq((e0 * 2)(), 2 * e0))</code>
</td><td>

<span style="color:green">GOOD</span>
</td><td>
time: 0.382000ms<br>
stack: size: 8<br><ul style="margin:0px"><li>Init<br><li>Prune<br><li>Expand<br><li>Prune<br><li>Factor<br><li>Prune<br><li>*:Tidy:apply<br><li>Tidy</ul>
</td></tr>
<tr><td>
<b></b><br>
<code>assert.eq( (e0 * 2)(), (2 * e0)() )</code>
</td><td>

<span style="color:green">GOOD</span>
</td><td>
time: 1.865000ms<br>
stack: size: 8<br><ul style="margin:0px"><li>Init<br><li>Prune<br><li>Expand<br><li>Prune<br><li>Factor<br><li>Prune<br><li>*:Tidy:apply<br><li>Tidy</ul>
</td></tr>
<tr><td>
<b></b><br>
<code>print((var'a' * e0)())
print((e0 * var'a')())
assert.eq(true, Expression.__eq(
	(var'a' * e0)(),
	(e0 * var'a')()
))</code>
</td><td>
${{a}} {{{e_{0}}}}$
${{a}} {{{e_{0}}}}$

<span style="color:green">GOOD</span>
</td><td>
time: 2.933000ms<br>
stack: size: 8<br><ul style="margin:0px"><li>Init<br><li>Prune<br><li>Expand<br><li>Prune<br><li>Factor<br><li>Prune<br><li>*:Tidy:apply<br><li>Tidy</ul>
</td></tr>
<tr><td>
<b></b><br>
<code>assert.eq( (e0 * var'a')(), (var'a' * e0)() )</code>
</td><td>

<span style="color:green">GOOD</span>
</td><td>
time: 0.399000ms<br>
stack: size: 8<br><ul style="margin:0px"><li>Init<br><li>Prune<br><li>Expand<br><li>Prune<br><li>Factor<br><li>Prune<br><li>*:Tidy:apply<br><li>Tidy</ul>
</td></tr>
