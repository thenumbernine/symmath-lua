<!doctype html>
<html>
	<head>
		<meta charset='utf-8'>
		<title>tests/unit/func</title>
		<script type='text/javascript' src='../tryToFindMathJax.js'></script>
	</head>
	<body onload='tryToFindMathJax();'>

<table border="1" style="border-collapse:collapse">
<tr><td>
<b></b><br>
<code>x = var'x'</code>
</td><td>

<span style="color:green">GOOD</span>
</td><td>
time: 0.019000ms<br>
stack: size: 0<br><ul style="margin:0px"></ul>
</td></tr>
<tr><td>
<b></b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b></b><br>
<code>y = func('y', {x}, x^2)</code>
</td><td>

<span style="color:green">GOOD</span>
</td><td>
time: 0.044000ms<br>
stack: size: 0<br><ul style="margin:0px"></ul>
</td></tr>
<tr><td>
<b>TODO what to display...</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>y = x</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>y(x) = x</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>y(x) := x</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b></b><br>
<code>print(y(x))</code>
</td><td>
$y\left(  x\right)$

<span style="color:green">GOOD</span>
</td><td>
time: 0.035000ms<br>
stack: size: 0<br><ul style="margin:0px"></ul>
</td></tr>
<tr><td>
<b></b><br>
<code>print(y(x)())</code>
</td><td>
${x}^{2}$

<span style="color:green">GOOD</span>
</td><td>
time: 1.303000ms<br>
stack: size: 11<br><ul style="margin:0px"><li>Init<br><li>y:Prune:apply<br><li>Prune<br><li>^:Expand:integerPower<br><li>Expand<br><li>+:Prune:combineConstants<br><li>*:Prune:apply<br><li>Prune<br><li>Factor<br><li>Prune<br><li>Tidy</ul>
</td></tr>
<tr><td>
<b></b><br>
<code>printbr(y:defeq())</code>
</td><td>
${y\left(  x\right)} = {{x}^{2}}$
<br>

<span style="color:green">GOOD</span>
</td><td>
time: 0.113000ms<br>
stack: size: 0<br><ul style="margin:0px"></ul>
</td></tr>
<tr><td>
<b></b><br>
<code>assert(UserFunction.registeredFunctions.y == y)</code>
</td><td>

<span style="color:green">GOOD</span>
</td><td>
time: 0.011000ms<br>
stack: size: 0<br><ul style="margin:0px"></ul>
</td></tr>
<tr><td>
<b></b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>if UserFunction is not a Variable then this is invalid</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>because you cannot have Functions as Variables in the arg list</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>f = func('f', {x, y}, x*y)</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>print(f:defeq())</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>assert(UserFunction.registeredFunctions.f == f)</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b></b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>instead, if UserFunction returns Functions, this is what you would see</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>and with this the derivative evaluation is obvious</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b></b><br>
<code>f = func('f', {x}, x*y(x))</code>
</td><td>

<span style="color:green">GOOD</span>
</td><td>
time: 0.064000ms<br>
stack: size: 0<br><ul style="margin:0px"></ul>
</td></tr>
<tr><td>
<b></b><br>
<code>print(f:defeq())</code>
</td><td>
${f\left(  x\right)} = {{{x}} {{y\left(  x\right)}}}$

<span style="color:green">GOOD</span>
</td><td>
time: 0.294000ms<br>
stack: size: 0<br><ul style="margin:0px"></ul>
</td></tr>
<tr><td>
<b></b><br>
<code>assert(UserFunction.registeredFunctions.f == f)</code>
</td><td>

<span style="color:green">GOOD</span>
</td><td>
time: 0.010000ms<br>
stack: size: 0<br><ul style="margin:0px"></ul>
</td></tr>
<tr><td>
<b></b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>diff() is partial derivative</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>totalDiff() is total derivative</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b></b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>total derivative evaluation</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>substitute chain rule for all terms</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>df/dx, when simplified, does not go anywhere, because f is dependent on x</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>for that reason, I can just build the equality f:eq(f.def) and apply :diff() to the whole thing:</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b></b><br>
<code>print(f:defeq():diff(x):prune())</code>
</td><td>
${{{3}} {{{x}^{2}}}} = {{{3}} {{{x}^{2}}}}$

<span style="color:green">GOOD</span>
</td><td>
time: 2.763000ms<br>
stack: size: 12<br><ul style="margin:0px"><li>f:Prune:apply<br><li>y:Prune:apply<br><li>+:Prune:combineConstants<br><li>*:Prune:apply<br><li>y:Prune:apply<br><li>+:Prune:combineConstants<br><li>*:Prune:apply<br><li>Derivative:Prune:self<br><li>Derivative:Prune:eval<br><li>Derivative:Prune:self<br><li>Derivative:Prune:eval<br><li>Derivative:Prune:eval</ul>
</td></tr>
<tr><td>
<b>but TODO wrt total derivatives ... diff(y) ...</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>y(x) above is a UserFunction subclass</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>which means it isn't a Variable</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>which means you can't diff(y) ...</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>though you could diff(y(x)) ...</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>but that would be diff'ing wrt expressions, which I don't have support for</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b></b><br>
<code>print(f:defeq():diff(y):prune())</code>
</td><td>
${0} = {0}$

<span style="color:green">GOOD</span>
</td><td>
time: 2.713000ms<br>
stack: size: 14<br><ul style="margin:0px"><li>f:Prune:apply<br><li>y:Prune:apply<br><li>+:Prune:combineConstants<br><li>*:Prune:apply<br><li>y:Prune:apply<br><li>+:Prune:combineConstants<br><li>*:Prune:apply<br><li>Derivative:Prune:other<br><li>*:Prune:apply<br><li>Derivative:Prune:eval<br><li>Derivative:Prune:other<br><li>*:Prune:apply<br><li>Derivative:Prune:eval<br><li>Derivative:Prune:eval</ul>
</td></tr>
<tr><td>
<b></b><br>
<code>print(f:defeq():diff(y(x)):prune())</code>
</td><td>
${0} = {0}$

<span style="color:green">GOOD</span>
</td><td>
time: 1.695000ms<br>
stack: size: 15<br><ul style="margin:0px"><li>f:Prune:apply<br><li>y:Prune:apply<br><li>+:Prune:combineConstants<br><li>*:Prune:apply<br><li>y:Prune:apply<br><li>y:Prune:apply<br><li>+:Prune:combineConstants<br><li>*:Prune:apply<br><li>Derivative:Prune:other<br><li>*:Prune:apply<br><li>Derivative:Prune:eval<br><li>Derivative:Prune:other<br><li>*:Prune:apply<br><li>Derivative:Prune:eval<br><li>Derivative:Prune:eval</ul>
</td></tr>
<tr><td>
<b></b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b></b><br>
<code>s = var's'</code>
</td><td>

<span style="color:green">GOOD</span>
</td><td>
time: 0.012000ms<br>
stack: size: 0<br><ul style="margin:0px"></ul>
</td></tr>
<tr><td>
<b></b><br>
<code>t = var't'</code>
</td><td>

<span style="color:green">GOOD</span>
</td><td>
time: 0.011000ms<br>
stack: size: 0<br><ul style="margin:0px"></ul>
</td></tr>
<tr><td>
<b></b><br>
<code>x = func('x', {s,t})</code>
</td><td>

<span style="color:green">GOOD</span>
</td><td>
time: 0.031000ms<br>
stack: size: 0<br><ul style="margin:0px"></ul>
</td></tr>
<tr><td>
<b></b><br>
<code>y = func('y', {s,t})</code>
</td><td>

<span style="color:green">GOOD</span>
</td><td>
time: 0.024000ms<br>
stack: size: 0<br><ul style="margin:0px"></ul>
</td></tr>
<tr><td>
<b></b><br>
<code>f = func('f', {x,y})</code>
</td><td>
<span style="color:red">BAD</span><br>/home/chris/Projects/lua/symmath/UserFunction.lua:141: args must be a table of Variables<br>
stack traceback:<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:216: in function </home/chris/Projects/lua/symmath/tests/unit/unit.lua:215><br>
	[C]: in function 'assert'<br>
	/home/chris/Projects/lua/symmath/UserFunction.lua:141: in function 'func'<br>
	[string "f = func('f', {x,y})"]:1: in main chunk<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:208: in function </home/chris/Projects/lua/symmath/tests/unit/unit.lua:207><br>
	[C]: in function 'xpcall'<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:207: in function 'exec'<br>
	func.lua:65: in function 'cb'<br>
	/home/chris/Projects/lua/ext/timer.lua:49: in function 'timer'<br>
	func.lua:6: in main chunk<br>
	[C]: at 0x563ce72863e0
</td><td>
time: 0.056000ms<br>
stack: size: 0<br><ul style="margin:0px"></ul>
</td></tr>
<tr><td>
<b>∂f/∂x</b><br>
<code>print(f:diff(x):prune())</code>
</td><td>
<span style="color:red">BAD</span><br>/home/chris/Projects/lua/symmath/Expression.lua:37: attempt to call a table value<br>
stack traceback:<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:216: in function </home/chris/Projects/lua/symmath/tests/unit/unit.lua:215><br>
	/home/chris/Projects/lua/symmath/Expression.lua:37: in function 'clone'<br>
	/home/chris/Projects/lua/symmath/Derivative.lua:328: in function 'func'<br>
	/home/chris/Projects/lua/symmath/visitor/Visitor.lua:213: in function 'prune'<br>
	[string "print(f:diff(x):prune())"]:1: in main chunk<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:208: in function </home/chris/Projects/lua/symmath/tests/unit/unit.lua:207><br>
	[C]: in function 'xpcall'<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:207: in function 'exec'<br>
	func.lua:65: in function 'cb'<br>
	/home/chris/Projects/lua/ext/timer.lua:49: in function 'timer'<br>
	func.lua:6: in main chunk<br>
	[C]: at 0x563ce72863e0
</td><td>
time: 0.152000ms<br>
stack: size: 0<br><ul style="margin:0px"></ul>
</td></tr>
<tr><td>
<b>∂f/∂y</b><br>
<code>print(f:diff(y):prune())</code>
</td><td>
<span style="color:red">BAD</span><br>/home/chris/Projects/lua/symmath/Expression.lua:37: attempt to call a table value<br>
stack traceback:<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:216: in function </home/chris/Projects/lua/symmath/tests/unit/unit.lua:215><br>
	/home/chris/Projects/lua/symmath/Expression.lua:37: in function 'clone'<br>
	/home/chris/Projects/lua/symmath/Derivative.lua:328: in function 'func'<br>
	/home/chris/Projects/lua/symmath/visitor/Visitor.lua:213: in function 'prune'<br>
	[string "print(f:diff(y):prune())"]:1: in main chunk<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:208: in function </home/chris/Projects/lua/symmath/tests/unit/unit.lua:207><br>
	[C]: in function 'xpcall'<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:207: in function 'exec'<br>
	func.lua:65: in function 'cb'<br>
	/home/chris/Projects/lua/ext/timer.lua:49: in function 'timer'<br>
	func.lua:6: in main chunk<br>
	[C]: at 0x563ce72863e0
</td><td>
time: 0.122000ms<br>
stack: size: 0<br><ul style="margin:0px"></ul>
</td></tr>
<tr><td>
<b>∂f/∂x ∂x/∂s + ∂f/∂y ∂y/∂s</b><br>
<code>print(f:diff(s):prune())</code>
</td><td>
<span style="color:red">BAD</span><br>/home/chris/Projects/lua/symmath/Expression.lua:37: attempt to call a table value<br>
stack traceback:<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:216: in function </home/chris/Projects/lua/symmath/tests/unit/unit.lua:215><br>
	/home/chris/Projects/lua/symmath/Expression.lua:37: in function 'clone'<br>
	/home/chris/Projects/lua/symmath/Derivative.lua:328: in function 'func'<br>
	/home/chris/Projects/lua/symmath/visitor/Visitor.lua:213: in function 'prune'<br>
	[string "print(f:diff(s):prune())"]:1: in main chunk<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:208: in function </home/chris/Projects/lua/symmath/tests/unit/unit.lua:207><br>
	[C]: in function 'xpcall'<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:207: in function 'exec'<br>
	func.lua:65: in function 'cb'<br>
	/home/chris/Projects/lua/ext/timer.lua:49: in function 'timer'<br>
	func.lua:6: in main chunk<br>
	[C]: at 0x563ce72863e0
</td><td>
time: 0.101000ms<br>
stack: size: 0<br><ul style="margin:0px"></ul>
</td></tr>
<tr><td>
<b>∂f/∂x ∂x/∂t + ∂f/∂y ∂y/∂t</b><br>
<code>print(f:diff(t):prune())</code>
</td><td>
<span style="color:red">BAD</span><br>/home/chris/Projects/lua/symmath/Expression.lua:37: attempt to call a table value<br>
stack traceback:<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:216: in function </home/chris/Projects/lua/symmath/tests/unit/unit.lua:215><br>
	/home/chris/Projects/lua/symmath/Expression.lua:37: in function 'clone'<br>
	/home/chris/Projects/lua/symmath/Derivative.lua:328: in function 'func'<br>
	/home/chris/Projects/lua/symmath/visitor/Visitor.lua:213: in function 'prune'<br>
	[string "print(f:diff(t):prune())"]:1: in main chunk<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:208: in function </home/chris/Projects/lua/symmath/tests/unit/unit.lua:207><br>
	[C]: in function 'xpcall'<br>
	/home/chris/Projects/lua/symmath/tests/unit/unit.lua:207: in function 'exec'<br>
	func.lua:65: in function 'cb'<br>
	/home/chris/Projects/lua/ext/timer.lua:49: in function 'timer'<br>
	func.lua:6: in main chunk<br>
	[C]: at 0x563ce72863e0
</td><td>
time: 0.080000ms<br>
stack: size: 0<br><ul style="margin:0px"></ul>
</td></tr>
<tr><td>
<b>TODO I need something to represent ∂/∂x "the def of f", rather than ∂/∂x "f", which is zero.</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
<tr><td>
<b>in contrast ∂/∂x "the def of f" would be a placeholder (in absense of f's provided definition)</b><br>
<code></code>
</td><td>
</td><td>
</td></tr>
