{
	{hidden=false, input="symmath.implicitVars = false\nsymmath.fixVariableNames = false\nop = symmath.op\n;", output="", outputtype="html", uid=6},
	{hidden=false, input="delta = Tensor:deltaSymbol() -- Kronecher delta. should this be default?", output="$δ$", outputtype="html", uid=1},
	{hidden=false, input="g = var'g'\nprint(g'_ij', '= metric tensor, in units of $[1]$');", output="${{ g} _i} _j$\9= metric tensor, in units of $[1]$<br>\n", outputtype="html", uid=28},
	{hidden=false, input="n = var'(n_1)'\nprint(n'^i', '= flux surface normal, in units of $[1]$');", output="${ {(n_1)}} ^i$\9= flux surface normal, in units of $[1]$<br>\n", outputtype="html", uid=30},
	{hidden=false, input="t, x, y, z = vars('t', 'x', 'y', 'z')\9-- coordinates\nxs = table{x, y, z}\ntxs = table{t, x, y, z}\n;", output="", outputtype="html", uid=29},
	{hidden=false, input="print'units of measurement:'\nunits = require 'symmath.physics.units'()\nm = units.m\nprint(m, '= meter')\ns = units.s\nprint(s, '= second')\nkg = units.kg\nprint(kg, '= kilogram')\nC = units.C\nprint(C, '= Coulomb');", output="units of measurement:<br>\n$m$\9= meter<br>\n$s$\9= second<br>\n$kg$\9= kilogram<br>\n$C$\9= Coulomb<br>\n", outputtype="html", uid=3},
	{hidden=false, input="print'constants:'\nmu_0 = units.mu_0\nprint(mu_0, [[= magnetic permeability, in units of]], (kg * m) / (C^2))\ngamma = var'\\\\gamma'\nprint(gamma, [[= heat capacity ratio, in units of $[1]$]])\ngammaMinusOne = var'(\\\\gamma_{-1})'\9-- = gamma - 1\n--gammaMinusOne = var'\\\\tilde{\\\\gamma}'    -- = gamma - 1\ngammaMinusOne_def = gammaMinusOne:eq(gamma - 1)\nprint(gammaMinusOne_def)\n;", output="constants:<br>\n${\\mu_0}$\9= magnetic permeability, in units of\9$\\frac{{{kg}} \\cdot {{m}}}{{C}^{2}}$<br>\n$\\gamma$\9= heat capacity ratio, in units of $[1]$<br>\n${{(\\gamma_{-1})}} = {{\\gamma}{-{1}}}$<br>\n", outputtype="html", uid=4},
	{hidden=false, input="rho = var('\\\\rho', txs)\nprint(rho, [[= density, in units of ]], kg/m^3);", output="$\\rho$\9= density, in units of \9$\\frac{kg}{{m}^{3}}$<br>\n", outputtype="html", uid=7},
	{hidden=false, input="v = var'v'\nv'^i':setDependentVars(txs:unpack())\nprint(v'^i', [[= velocity, in units of ]], m/s);", output="${ v} ^i$\9= velocity, in units of \9${\\frac{1}{s}} {m}$<br>\n", outputtype="html", uid=8},
	{hidden=false, input="vSq_var = var('(v)^2')\nvSq_wrt_v = v'^k' * v'^l' * g'_kl'\nvSq_def = vSq_var:eq(vSq_wrt_v)\nprint(vSq_def, [[= velocity norm squared, in units of]], m^2/s^2);", output="${{(v)^2}} = {{{{ v} ^k}} {{{ v} ^l}} {{{{ g} _k} _l}}}$\9= velocity norm squared, in units of\9$\\frac{{m}^{2}}{{s}^{2}}$<br>\n", outputtype="html", uid=9},
	{hidden=false, input="p = var'p'\np_from_v = p'^i':eq(rho * v'^i')\nprint(p_from_v, [[= momentum, in units of ]], kg/(m^2 * s));", output="${{ p} ^i} = {{{\\rho}} \\cdot {{{ v} ^i}}}$\9= momentum, in units of \9$\\frac{kg}{{{{m}^{2}}} {{s}}}$<br>\n", outputtype="html", uid=10},
	{hidden=false, input="pSq_var = var('(p)^2')", output="${(p)^2}$", outputtype="html", uid=31},
	{hidden=false, input="B = var'B'\nB'^i':setDependentVars(txs:unpack())\nprint(B'^i', [[= magnetic field, in units of]], kg/(C*s));", output="${ B} ^i$\9= magnetic field, in units of\9$\\frac{kg}{{{C}} {{s}}}$<br>\n", outputtype="html", uid=11},
	{hidden=false, input="BSq_var = var('(B)^2')\nBSq_wrt_B = B'^k' * B'^l' * g'_kl'\nBSq_def = BSq_var:eq(BSq_wrt_B)\nprint(BSq_def, [[= magnetic field norm squared, in units of]], kg^2/(C*s)^2);", output="${{(B)^2}} = {{{{ B} ^k}} {{{ B} ^l}} {{{{ g} _k} _l}}}$\9= magnetic field norm squared, in units of\9$\\frac{{kg}^{2}}{{\\left({{{C}} {{s}}}\\right)}^{2}}$<br>\n", outputtype="html", uid=12},
	{hidden=false, input="P = var('P', txs)\nprint(P, [[= pressure due to hydro, in units of]], kg / (m * s^2));", output="$P$\9= pressure due to hydro, in units of\9$\\frac{kg}{{{m}} {{{s}^{2}}}}$<br>\n", outputtype="html", uid=21},
	{hidden=false, input="P_mag = var'P_{mag}'\nP_mag_def = P_mag:eq(frac(1,2) * BSq_var / mu_0)\nprint(P_mag_def, [[= pressure due to magnetic field, in units of]], kg / (m * s^2));", output="${{P_{mag}}} = {{\\frac{1}{{\\mu_0}}} {{{\\frac{1}{2}}} {{{(B)^2}}}}}$\9= pressure due to magnetic field, in units of\9$\\frac{kg}{{{m}} {{{s}^{2}}}}$<br>\n", outputtype="html", uid=13},
	{hidden=false, input="P_total_with_mag = var'P_{MHD}'\nP_total_with_mag_def = P_total_with_mag:eq(P + P_mag)\nprint(P_total_with_mag_def, [[= total pressure, in units of]], kg/(m*s^2));", output="${{P_{MHD}}} = {{P} + {{P_{mag}}}}$\9= total pressure, in units of\9$\\frac{kg}{{{m}} {{{s}^{2}}}}$<br>\n", outputtype="html", uid=14},
	{hidden=false, input="P_total_with_mag_wrt_W =  P_total_with_mag_def:subst(P_mag_def)", output="${{P_{MHD}}} = {{P} + {{\\frac{1}{{\\mu_0}}} {{{\\frac{1}{2}}} {{{(B)^2}}}}}}$", outputtype="html", uid=15},
	{hidden=false, input="e_kin = var'e_{kin}'\ne_kin_def = e_kin:eq(frac(1,2) * vSq_wrt_v)                   -- specific kinetic energy\nprint(e_kin_def, [[= specific kinetic energy, in units of]], m^2/s^2);", output="${{e_{kin}}} = {{{\\frac{1}{2}}} {{{ v} ^k}} {{{ v} ^l}} {{{{ g} _k} _l}}}$\9= specific kinetic energy, in units of\9$\\frac{{m}^{2}}{{s}^{2}}$<br>\n", outputtype="html", uid=16},
	{hidden=false, input="e_int = var'e_{int}'\ne_int_def = e_int:eq(P / (gammaMinusOne * rho))      -- specific internal energy \nprint(e_int_def, [[= specific internal energy, in units of]], m^2/s^2);", output="${{e_{int}}} = {\\frac{P}{{{{(\\gamma_{-1})}}} \\cdot {{\\rho}}}}$\9= specific internal energy, in units of\9$\\frac{{m}^{2}}{{s}^{2}}$<br>\n", outputtype="html", uid=17},
	{hidden=false, input="E_hydro = var'E_{hydro}'\nE_hydro_def = E_hydro:eq(rho * (e_int + e_kin))   -- hydro energy\nprint(E_hydro_def, [[= densitized hydro energy, in units of]], kg / (m * s^2));", output="${{E_{hydro}}} = {{{\\rho}} \\cdot {{\\left({{{e_{int}}} + {{e_{kin}}}}\\right)}}}$\9= densitized hydro energy, in units of\9$\\frac{kg}{{{m}} {{{s}^{2}}}}$<br>\n", outputtype="html", uid=18},
	{hidden=false, input="E_hydro_wrt_W = E_hydro_def:subst(e_int_def, e_kin_def, vSq_def:switch()):simplifyAddMulDiv()", output="${{E_{hydro}}} = {{{{P}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{\\frac{1}{2}}} {{{(v)^2}}} \\cdot {{\\rho}}}}$", outputtype="html", uid=19},
	{hidden=false, input="E_mag = var'E_{mag}'\nE_mag_def = E_mag:eq(P_mag_def:rhs()) -- same def\nprint(E_mag_def, [[= energy from magnetic field, in units of]], kg/(m*s^2));", output="${{E_{mag}}} = {{\\frac{1}{{\\mu_0}}} {{{\\frac{1}{2}}} {{{(B)^2}}}}}$\9= energy from magnetic field, in units of\9$\\frac{kg}{{{m}} {{{s}^{2}}}}$<br>\n", outputtype="html", uid=20},
	{hidden=false, input="E_total_with_mag = var'E_{MHD}'\nE_total_with_mag_def = E_total_with_mag:eq(rho * (e_int + e_kin) + E_mag)\nprint(E_total_with_mag_def, [[= total energy, in units of]], kg/(m*s^2));", output="${{E_{MHD}}} = {{{{\\rho}} \\cdot {{\\left({{{e_{int}}} + {{e_{kin}}}}\\right)}}} + {{E_{mag}}}}$\9= total energy, in units of\9$\\frac{kg}{{{m}} {{{s}^{2}}}}$<br>\n", outputtype="html", uid=22},
	{hidden=false, input="E_total_with_mag_wrt_W = E_total_with_mag_def:subst(e_int_def, e_kin_def, vSq_def:switch(), E_mag_def):simplifyAddMulDiv()", output="${{E_{MHD}}} = {{{{\\frac{1}{2}}} {{{(B)^2}}} \\cdot {{\\frac{1}{{\\mu_0}}}}} + {{{P}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{\\frac{1}{2}}} {{{(v)^2}}} \\cdot {{\\rho}}}}$", outputtype="html", uid=23},
	{hidden=false, input="H_total_with_mag = var'H_{MHD}'\nH_total_with_mag_def = H_total_with_mag:eq(E_total_with_mag + P_total_with_mag)\nprint(H_total_with_mag_def, [[= total enthalpy, in units of]], kg / (m * s^2));", output="${{H_{MHD}}} = {{{E_{MHD}}} + {{P_{MHD}}}}$\9= total enthalpy, in units of\9$\\frac{kg}{{{m}} {{{s}^{2}}}}$<br>\n", outputtype="html", uid=24},
	{hidden=false, input="H_total_with_mag_wrt_W = H_total_with_mag_def:subst(E_total_with_mag_wrt_W, P_total_with_mag_wrt_W, vSq_def:switch()):simplifyAddMulDiv()", output="${{H_{MHD}}} = {{{{{(B)^2}}} \\cdot {{\\frac{1}{{\\mu_0}}}}} + {{{P}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {P} + {{{\\frac{1}{2}}} {{{(v)^2}}} \\cdot {{\\rho}}}}$", outputtype="html", uid=25},
	{hidden=false, input="Cs = var'c_s'\nCs_def = Cs:eq(sqrt((gamma * P) / rho))\nprint(Cs_def, [[= speed of sound in units of ]], m / s);", output="${{c_s}} = {\\sqrt{{\\frac{1}{\\rho}} {{{\\gamma}} \\cdot {{P}}}}}$\9= speed of sound in units of \9${\\frac{1}{s}} {m}$<br>\n", outputtype="html", uid=26},
	{hidden=false, input="-- TODO this is in \"Euler fluid equations - flux eigenvectors.symmath\" as well ... is it used in either?\nc = var'c'\9\9\9-- commutation\nGamma = var'\\\\Gamma'-- connection\nS = var'S'\9\9\9-- source terms\n;", output="", outputtype="html", uid=27},
	{hidden=false, input="-- equations \n\nA, W, U = vars('A', 'W', 'U');", output="", outputtype="html", uid=32},
	{hidden=false, input="print'Finite volume form:'", output="Finite volume form:<br>\n", outputtype="html", uid=33},
	{hidden=false, input="(U'^I_,t' + var'F(n^j)''^I_;j'):eq(0)", output="${{{{ U} ^I} _{,t}} + {{{ {F(n^j)}} ^I} _{;j}}} = {0}$", outputtype="html", uid=34},
	{hidden=false, input="print'As flux Jacobian:'", output="As flux Jacobian:<br>\n", outputtype="html", uid=35},
	{hidden=false, input="(U'^I_,t' \n\9+ var'F(n^j)''^I':diff(U'^J') * U'^J_;j'\n):eq(0)", output="${{{{ U} ^I} _{,t}} + {{{\\frac{\\partial { {F(n^j)}} ^I}{\\partial { U} ^J}}} {{{{ U} ^J} _{;j}}}}} = {0}$", outputtype="html", uid=36},
	{hidden=false, input="print'As eigensystem of jacobian:'", output="As eigensystem of jacobian:<br>\n", outputtype="html", uid=37},
	{hidden=false, input="(U'_,t'\n\9+ var'R_F(n^j)' * var'\\\\Lambda_F(n^j)' * var'L_F(n^j)' * U'_;j'\n):eq(0)", output="${{{ U} _{,t}} + {{{{R_F(n^j)}}} \\cdot {{{\\Lambda_F(n^j)}}} \\cdot {{{L_F(n^j)}}} \\cdot {{{ U} _{;j}}}}} = {0}$", outputtype="html", uid=38},
	{hidden=false, input="print'As characteristic variables:'", output="As characteristic variables:<br>\n", outputtype="html", uid=39},
	{hidden=false, input="(\9\n\9var'L_F(n^j)'\n\9* U'_,t'\n\9+ \n\9var'L_F(n^j)' \n\9* var'R_F(n^j)' \n\9* var'\\\\Lambda_F(n^j)' \n\9* var'L_F(n^j)' \n\9* var'R_F(n^j)' \n\9* var'L_F(n^j)' \n\9* U'_;j'\n):eq(0)", output="${{{{{L_F(n^j)}}} \\cdot {{{ U} _{,t}}}} + {{{{L_F(n^j)}}} \\cdot {{{R_F(n^j)}}} \\cdot {{{\\Lambda_F(n^j)}}} \\cdot {{{L_F(n^j)}}} \\cdot {{{R_F(n^j)}}} \\cdot {{{L_F(n^j)}}} \\cdot {{{ U} _{;j}}}}} = {0}$", outputtype="html", uid=40},
	{hidden=false, input="(\9\n\9var'L_F(n^j)'\n\9* U'_,t'\n\9+ \n\9var'\\\\Lambda_F(n^j)' \n\9* var'L_F(n^j)' \n\9* U'_;j'\n):eq(0)", output="${{{{{L_F(n^j)}}} \\cdot {{{ U} _{,t}}}} + {{{{\\Lambda_F(n^j)}}} \\cdot {{{L_F(n^j)}}} \\cdot {{{ U} _{;j}}}}} = {0}$", outputtype="html", uid=41},
	{hidden=false, input="print'As a PDE of primitive variables:'", output="As a PDE of primitive variables:<br>\n", outputtype="html", uid=43},
	{hidden=false, input="-- dU/dt + dF(n)/dU dU/dx = 0\n(U'_,t' \n\9+ var'F(n^j)':diff(U) \n\9* U'_;j'\n):eq(0)", output="${{{ U} _{,t}} + {{{\\frac{\\partial {F(n^j)}}{\\partial U}}} {{{ U} _{;j}}}}} = {0}$", outputtype="html", uid=44},
	{hidden=false, input="-- dW/dU dU/dt + dW/dU dF(n)/dU dU/dW dW/dU dU/dx = 0\n(\n\9W:diff(U) \n\9* U'_,t' \n\9+ \n\9W:diff(U)\n\9* var'F(n^j)':diff(U) \n\9* U:diff(W)\n\9* W:diff(U)\n\9* U'_;j'\n):eq(0)", output="${{{{\\frac{\\partial W}{\\partial U}}} {{{ U} _{,t}}}} + {{{\\frac{\\partial W}{\\partial U}}} {{\\frac{\\partial {F(n^j)}}{\\partial U}}} {{\\frac{\\partial U}{\\partial W}}} {{\\frac{\\partial W}{\\partial U}}} {{{ U} _{;j}}}}} = {0}$", outputtype="html", uid=45},
	{hidden=false, input="--dW/dt + dW/dU dF(n)/dU dU/dW dW/dx = 0\n(\n\9W'_,t' \n\9+ \n\9W:diff(U)\n\9* var'F(n^j)':diff(U) \n\9* U:diff(W)\n\9* W'_;j'\n):eq(0)", output="${{{ W} _{,t}} + {{{\\frac{\\partial W}{\\partial U}}} {{\\frac{\\partial {F(n^j)}}{\\partial U}}} {{\\frac{\\partial U}{\\partial W}}} {{{ W} _{;j}}}}} = {0}$", outputtype="html", uid=46},
	{hidden=false, input="-- dW/dt + dW/dU dF(n)/dW dW/dx = 0 \n(\n\9W'_,t' \n\9+ \n\9W:diff(U)\n\9* var'F(n^j)':diff(W) \n\9* W'_;j'\n):eq(0)", output="${{{ W} _{,t}} + {{{\\frac{\\partial W}{\\partial U}}} {{\\frac{\\partial {F(n^j)}}{\\partial W}}} {{{ W} _{;j}}}}} = {0}$", outputtype="html", uid=47},
	{hidden=false, input="print('...where ', W:diff(U) * var'F(n^j)':diff(W) , 'is equal to the acoustic matrix plus a diagonal of the velocity along the flux normal, as we will see below.')", output="...where \9${{\\frac{\\partial W}{\\partial U}}} {{\\frac{\\partial {F(n^j)}}{\\partial W}}}$\9is equal to the acoustic matrix plus a diagonal of the velocity along the flux normal, as we will see below.<br>\n", outputtype="html", uid=48},
	{hidden=false, input="( W'_,t' + (A + var'I' * v'^j') * W'_;j' ):eq(0)", output="${{{ W} _{,t}} + {{{\\left({{A} + {{{I}} {{{ v} ^j}}}}\\right)}} {{{ W} _{;j}}}}} = {0}$", outputtype="html", uid=49},
	{hidden=false, input="(\n\9W'_,t' \n\9+ \n\9var'F_W(n^j)':diff(W) \n\9* W'_;j'\n):eq(0)", output="${{{ W} _{,t}} + {{{\\frac{\\partial {F_W(n^j)}}{\\partial W}}} {{{ W} _{;j}}}}} = {0}$", outputtype="html", uid=50},
	{hidden=false, input="(W'_,t' + var'F_W(n^j)''_;j'):eq(0)", output="${{{ W} _{,t}} + {{ {F_W(n^j)}} _{;j}}} = {0}$", outputtype="html", uid=51},
	{hidden=false, input="print'Conserved and primitive variables:'", output="Conserved and primitive variables:<br>\n", outputtype="html", uid=52},
	{hidden=false, input="W_def = Matrix{rho, v'^i', B'^i', P}:T()\nprint(W'^I':eq(W_def));", output="${{ W} ^I} = {\\left[\\begin{matrix}  \\rho \\\\  { v} ^i \\\\  { B} ^i \\\\  P\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=53},
	{hidden=false, input="U_def = Matrix{rho, p'^i', B'^i', E_total_with_mag}:T()\nprint(U'^I':eq(U_def));", output="${{ U} ^I} = {\\left[\\begin{matrix}  \\rho \\\\  { p} ^i \\\\  { B} ^i \\\\  {E_{MHD}}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=54},
	{hidden=false, input="U_wrt_W = Matrix{rho, rho * v'^x', rho * v'^y', rho * v'^z',  B'^x', B'^y', B'^z', E_total_with_mag_wrt_W[2]}:T()\nprint(U'^I':eq(U_wrt_W));", output="${{ U} ^I} = {\\left[\\begin{matrix}  \\rho \\\\  {{\\rho}} \\cdot {{{ v} ^x}} \\\\  {{\\rho}} \\cdot {{{ v} ^y}} \\\\  {{\\rho}} \\cdot {{{ v} ^z}} \\\\  { B} ^x \\\\  { B} ^y \\\\  { B} ^z \\\\  {{{\\frac{1}{2}}} {{{(B)^2}}} \\cdot {{\\frac{1}{{\\mu_0}}}}} + {{{P}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{\\frac{1}{2}}} {{{(v)^2}}} \\cdot {{\\rho}}}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=55},
	{hidden=false, input="W_wrt_U = Matrix{\n    rho,\n    p'^x' / rho,\n    p'^y' / rho,\n    p'^z' / rho,\n    E_total_with_mag_wrt_W:solve(P):rhs():replace(vSq_var, pSq_var / rho^2):simplifyAddMulDiv()\n}:T()\nprint(W'^I':eq(W_wrt_U));", output="${{ W} ^I} = {\\left[\\begin{matrix}  \\rho \\\\  {\\frac{1}{\\rho}} {{ p} ^x} \\\\  {\\frac{1}{\\rho}} {{ p} ^y} \\\\  {\\frac{1}{\\rho}} {{ p} ^z} \\\\  {{{-1}} \\cdot {{\\frac{1}{2}}} {{{(B)^2}}} \\cdot {{{(\\gamma_{-1})}}} \\cdot {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} \\cdot {{\\frac{1}{2}}} {{{(\\gamma_{-1})}}} \\cdot {{{(p)^2}}} \\cdot {{\\frac{1}{\\rho}}}} + {{{{(\\gamma_{-1})}}} \\cdot {{{E_{MHD}}}}}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=56},
	{hidden=false, input="print'Partial of conserved quantities wrt primitives:'", output="Partial of conserved quantities wrt primitives:<br>\n", outputtype="html", uid=57},
	{hidden=false, input="dU_dW_def = Matrix:lambda({4,4}, function(i,j)\n\9return U_def[i][1]:diff( W_def[j][1]:reindex{i='j'} )\nend)\nprint(U'^I':diff(W'^J'):eq(dU_dW_def));", output="${\\frac{\\partial { U} ^I}{\\partial { W} ^J}} = {\\left[\\begin{matrix}  \\frac{\\partial \\rho}{\\partial \\rho} &amp;  \\frac{\\partial \\rho}{\\partial { v} ^j} &amp;  \\frac{\\partial \\rho}{\\partial { B} ^j} &amp;  \\frac{\\partial \\rho}{\\partial P} \\\\  \\frac{\\partial { p} ^i}{\\partial \\rho} &amp;  \\frac{\\partial { p} ^i}{\\partial { v} ^j} &amp;  \\frac{\\partial { p} ^i}{\\partial { B} ^j} &amp;  \\frac{\\partial { p} ^i}{\\partial P} \\\\  \\frac{\\partial { B} ^i}{\\partial \\rho} &amp;  \\frac{\\partial { B} ^i}{\\partial { v} ^j} &amp;  \\frac{\\partial { B} ^i}{\\partial { B} ^j} &amp;  \\frac{\\partial { B} ^i}{\\partial P} \\\\  \\frac{\\partial {E_{MHD}}}{\\partial \\rho} &amp;  \\frac{\\partial {E_{MHD}}}{\\partial { v} ^j} &amp;  \\frac{\\partial {E_{MHD}}}{\\partial { B} ^j} &amp;  \\frac{\\partial {E_{MHD}}}{\\partial P}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=58},
	{hidden=false, input="dU_dW_def = dU_dW_def:subst(p_from_v, E_total_with_mag_def, E_mag_def, e_kin_def, vSq_def, e_int_def, BSq_def)\nprint(U'^I':diff(W'^J'):eq(dU_dW_def));", output="${\\frac{\\partial { U} ^I}{\\partial { W} ^J}} = {\\left[\\begin{matrix}  \\frac{\\partial \\rho}{\\partial \\rho} &amp;  \\frac{\\partial \\rho}{\\partial { v} ^j} &amp;  \\frac{\\partial \\rho}{\\partial { B} ^j} &amp;  \\frac{\\partial \\rho}{\\partial P} \\\\  {\\frac{\\partial}{\\partial \\rho}}\\left({{{\\rho}} \\cdot {{{ v} ^i}}}\\right) &amp;  {\\frac{\\partial}{\\partial { v} ^j}}\\left({{{\\rho}} \\cdot {{{ v} ^i}}}\\right) &amp;  {\\frac{\\partial}{\\partial { B} ^j}}\\left({{{\\rho}} \\cdot {{{ v} ^i}}}\\right) &amp;  {\\frac{\\partial}{\\partial P}}\\left({{{\\rho}} \\cdot {{{ v} ^i}}}\\right) \\\\  \\frac{\\partial { B} ^i}{\\partial \\rho} &amp;  \\frac{\\partial { B} ^i}{\\partial { v} ^j} &amp;  \\frac{\\partial { B} ^i}{\\partial { B} ^j} &amp;  \\frac{\\partial { B} ^i}{\\partial P} \\\\  {\\frac{\\partial}{\\partial \\rho}}\\left({{{{\\rho}} \\cdot {{\\left({{{{\\frac{1}{2}}} {{{ v} ^k}} {{{ v} ^l}} {{{{ g} _k} _l}}} + {\\frac{P}{{{{(\\gamma_{-1})}}} \\cdot {{\\rho}}}}}\\right)}}} + {{\\frac{1}{{\\mu_0}}} {{{\\frac{1}{2}}} {{{{{ B} ^k}} {{{ B} ^l}} {{{{ g} _k} _l}}}}}}}\\right) &amp;  {\\frac{\\partial}{\\partial { v} ^j}}\\left({{{{\\rho}} \\cdot {{\\left({{{{\\frac{1}{2}}} {{{ v} ^k}} {{{ v} ^l}} {{{{ g} _k} _l}}} + {\\frac{P}{{{{(\\gamma_{-1})}}} \\cdot {{\\rho}}}}}\\right)}}} + {{\\frac{1}{{\\mu_0}}} {{{\\frac{1}{2}}} {{{{{ B} ^k}} {{{ B} ^l}} {{{{ g} _k} _l}}}}}}}\\right) &amp;  {\\frac{\\partial}{\\partial { B} ^j}}\\left({{{{\\rho}} \\cdot {{\\left({{{{\\frac{1}{2}}} {{{ v} ^k}} {{{ v} ^l}} {{{{ g} _k} _l}}} + {\\frac{P}{{{{(\\gamma_{-1})}}} \\cdot {{\\rho}}}}}\\right)}}} + {{\\frac{1}{{\\mu_0}}} {{{\\frac{1}{2}}} {{{{{ B} ^k}} {{{ B} ^l}} {{{{ g} _k} _l}}}}}}}\\right) &amp;  {\\frac{\\partial}{\\partial P}}\\left({{{{\\rho}} \\cdot {{\\left({{{{\\frac{1}{2}}} {{{ v} ^k}} {{{ v} ^l}} {{{{ g} _k} _l}}} + {\\frac{P}{{{{(\\gamma_{-1})}}} \\cdot {{\\rho}}}}}\\right)}}} + {{\\frac{1}{{\\mu_0}}} {{{\\frac{1}{2}}} {{{{{ B} ^k}} {{{ B} ^l}} {{{{ g} _k} _l}}}}}}}\\right)\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=59},
	{hidden=false, input="dU_dW_def = dU_dW_def()\ndU_dW_def = dU_dW_def:subst(vSq_def:switch()())\ndU_dW_def[4][2] = dU_dW_def[4][2]:simplifyMetrics()()\ndU_dW_def[4][3] = dU_dW_def[4][3]:simplifyMetrics()()\nprint(U'^I':diff(W'^J'):eq(dU_dW_def));", output="${\\frac{\\partial { U} ^I}{\\partial { W} ^J}} = {\\left[\\begin{matrix}  1 &amp;  0 &amp;  0 &amp;  0 \\\\  { v} ^i &amp;  {{\\rho}} \\cdot {{{{ δ} ^i} _j}} &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  {{ δ} ^i} _j &amp;  0 \\\\  {\\frac{1}{2}} {{(v)^2}} &amp;  {{\\rho}} \\cdot {{{ v} _j}} &amp;  {\\frac{1}{{\\mu_0}}} {{ B} _j} &amp;  \\frac{1}{{(\\gamma_{-1})}}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=60},
	{hidden=false, input="-- this doesn't work with indexed elements of the matrix.  you'd have to either expand it, or ... do some math \n--local dW_dU_def = dU_dW_def:inverse()\ndW_dU_def = Matrix(\n\9{1, 0, 0, 0},\n\9{-v'^i' / rho, delta'^i_j' / rho, 0, 0},\n\9{0, 0, delta'^i_j', 0},\n\9{frac(1,2) * gammaMinusOne * vSq_wrt_v, -gammaMinusOne * v'_j', -gammaMinusOne / mu_0 * B'_j', gammaMinusOne}\n)\nprint(W'^I':diff(U'^J'):eq(dW_dU_def));", output="${\\frac{\\partial { W} ^I}{\\partial { U} ^J}} = {\\left[\\begin{matrix}  1 &amp;  0 &amp;  0 &amp;  0 \\\\  {\\frac{1}{\\rho}}{\\left({-{{ v} ^i}}\\right)} &amp;  {\\frac{1}{\\rho}} {{{ δ} ^i} _j} &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  {{ δ} ^i} _j &amp;  0 \\\\  {{\\frac{1}{2}}} {{{(\\gamma_{-1})}}} \\cdot {{{ v} ^k}} {{{ v} ^l}} {{{{ g} _k} _l}} &amp;   {-{{(\\gamma_{-1})}}} {{{ v} _j}} &amp;  {{{\\frac{1}{{\\mu_0}}}{\\left({-{{(\\gamma_{-1})}}}\\right)}}} {{{ B} _j}} &amp;  {(\\gamma_{-1})}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=62},
	{hidden=false, input="print'Flux:'", output="Flux:<br>\n", outputtype="html", uid=63},
	{hidden=false, input="F = var'F'\nF_def = Matrix{\n\9rho * v'^j' * n'_j',\n\9rho * v'^i' * v'^j' * n'_j' + n'^i' * P_total_with_mag - 1/mu_0 * B'^i' * B'^j' * n'_j',\n\9B'^i' * v'^j' * n'_j' - v'^i' * B'^j' * n'_j',\n\9v'^j' * n'_j' * H_total_with_mag - 1/mu_0 * B'^k' * v'_k' * B'^j' * n'_j'\n}:T()\nprint(F'^I':eq(F_def));", output="${{ F} ^I} = {\\left[\\begin{matrix}  {{\\rho}} \\cdot {{{ v} ^j}} {{{ {(n_1)}} _j}} \\\\  {{{{\\rho}} \\cdot {{{ v} ^i}} {{{ v} ^j}} {{{ {(n_1)}} _j}}} + {{{{ {(n_1)}} ^i}} {{{P_{MHD}}}}}}{-{{{\\frac{1}{{\\mu_0}}}} {{{ B} ^i}} {{{ B} ^j}} {{{ {(n_1)}} _j}}}} \\\\  {{{{ B} ^i}} {{{ v} ^j}} {{{ {(n_1)}} _j}}}{-{{{{ v} ^i}} {{{ B} ^j}} {{{ {(n_1)}} _j}}}} \\\\  {{{{ v} ^j}} {{{ {(n_1)}} _j}} {{{H_{MHD}}}}}{-{{{\\frac{1}{{\\mu_0}}}} {{{ B} ^k}} {{{ v} _k}} {{{ B} ^j}} {{{ {(n_1)}} _j}}}}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=64},
	{hidden=false, input="F_def = F_def:subst(H_total_with_mag_def, E_total_with_mag_def, E_mag_def, P_total_with_mag_def, P_mag_def, e_int_def, e_kin_def, BSq_def):simplifyAddMulDiv()\nprint(F'^I':eq(F_def));", output="${{ F} ^I} = {\\left[\\begin{matrix}  {{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^j}} \\\\  {{{P}} {{{ {(n_1)}} ^i}}} + {{{\\frac{1}{2}}} {{{ {(n_1)}} ^i}} {{{ B} ^k}} {{{ B} ^l}} {{{{ g} _k} _l}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^i}} {{{ B} ^j}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^i}} {{{ v} ^j}}} \\\\  {{{{ {(n_1)}} _j}} {{{ B} ^i}} {{{ v} ^j}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^j}} {{{ v} ^i}}} \\\\  {{{P}} {{{ {(n_1)}} _j}} {{{ v} ^j}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{P}} {{{ {(n_1)}} _j}} {{{ v} ^j}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^j}} {{{ B} ^k}} {{{ v} _k}} {{\\frac{1}{{\\mu_0}}}}} + {{{{ {(n_1)}} _j}} {{{ B} ^k}} {{{ B} ^l}} {{{ v} ^j}} {{{{ g} _k} _l}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\frac{1}{2}}} {{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^j}} {{{ v} ^k}} {{{ v} ^l}} {{{{ g} _k} _l}}}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=65},
	{hidden=false, input="print'Flux derivative wrt primitive variables:'\ndF_dW_def = Matrix:lambda({4,4}, function(i,j)\n\9return F_def[i][1]:reindex{jkl='klm'}:diff( W_def[j][1]:reindex{i='j'})\nend)\nprint(F'^I':diff(W'^J'):eq(dF_dW_def));", output="Flux derivative wrt primitive variables:<br>\n${\\frac{\\partial { F} ^I}{\\partial { W} ^J}} = {\\left[\\begin{matrix}  {\\frac{\\partial}{\\partial \\rho}}\\left({{{\\rho}} \\cdot {{{ {(n_1)}} _k}} {{{ v} ^k}}}\\right) &amp;  {\\frac{\\partial}{\\partial { v} ^j}}\\left({{{\\rho}} \\cdot {{{ {(n_1)}} _k}} {{{ v} ^k}}}\\right) &amp;  {\\frac{\\partial}{\\partial { B} ^j}}\\left({{{\\rho}} \\cdot {{{ {(n_1)}} _k}} {{{ v} ^k}}}\\right) &amp;  {\\frac{\\partial}{\\partial P}}\\left({{{\\rho}} \\cdot {{{ {(n_1)}} _k}} {{{ v} ^k}}}\\right) \\\\  {\\frac{\\partial}{\\partial \\rho}}\\left({{{{P}} {{{ {(n_1)}} ^i}}} + {{{\\frac{1}{2}}} {{{ {(n_1)}} ^i}} {{{ B} ^l}} {{{ B} ^m}} {{{{ g} _l} _m}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^i}} {{{ B} ^k}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _k}} {{{ v} ^i}} {{{ v} ^k}}}}\\right) &amp;  {\\frac{\\partial}{\\partial { v} ^j}}\\left({{{{P}} {{{ {(n_1)}} ^i}}} + {{{\\frac{1}{2}}} {{{ {(n_1)}} ^i}} {{{ B} ^l}} {{{ B} ^m}} {{{{ g} _l} _m}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^i}} {{{ B} ^k}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _k}} {{{ v} ^i}} {{{ v} ^k}}}}\\right) &amp;  {\\frac{\\partial}{\\partial { B} ^j}}\\left({{{{P}} {{{ {(n_1)}} ^i}}} + {{{\\frac{1}{2}}} {{{ {(n_1)}} ^i}} {{{ B} ^l}} {{{ B} ^m}} {{{{ g} _l} _m}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^i}} {{{ B} ^k}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _k}} {{{ v} ^i}} {{{ v} ^k}}}}\\right) &amp;  {\\frac{\\partial}{\\partial P}}\\left({{{{P}} {{{ {(n_1)}} ^i}}} + {{{\\frac{1}{2}}} {{{ {(n_1)}} ^i}} {{{ B} ^l}} {{{ B} ^m}} {{{{ g} _l} _m}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^i}} {{{ B} ^k}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _k}} {{{ v} ^i}} {{{ v} ^k}}}}\\right) \\\\  {\\frac{\\partial}{\\partial \\rho}}\\left({{{{{ {(n_1)}} _k}} {{{ B} ^i}} {{{ v} ^k}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^k}} {{{ v} ^i}}}}\\right) &amp;  {\\frac{\\partial}{\\partial { v} ^j}}\\left({{{{{ {(n_1)}} _k}} {{{ B} ^i}} {{{ v} ^k}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^k}} {{{ v} ^i}}}}\\right) &amp;  {\\frac{\\partial}{\\partial { B} ^j}}\\left({{{{{ {(n_1)}} _k}} {{{ B} ^i}} {{{ v} ^k}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^k}} {{{ v} ^i}}}}\\right) &amp;  {\\frac{\\partial}{\\partial P}}\\left({{{{{ {(n_1)}} _k}} {{{ B} ^i}} {{{ v} ^k}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^k}} {{{ v} ^i}}}}\\right) \\\\  {\\frac{\\partial}{\\partial \\rho}}\\left({{{{P}} {{{ {(n_1)}} _k}} {{{ v} ^k}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{P}} {{{ {(n_1)}} _k}} {{{ v} ^k}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^k}} {{{ B} ^l}} {{{ v} _l}} {{\\frac{1}{{\\mu_0}}}}} + {{{{ {(n_1)}} _k}} {{{ B} ^l}} {{{ B} ^m}} {{{ v} ^k}} {{{{ g} _l} _m}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\frac{1}{2}}} {{\\rho}} \\cdot {{{ {(n_1)}} _k}} {{{ v} ^k}} {{{ v} ^l}} {{{ v} ^m}} {{{{ g} _l} _m}}}}\\right) &amp;  {\\frac{\\partial}{\\partial { v} ^j}}\\left({{{{P}} {{{ {(n_1)}} _k}} {{{ v} ^k}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{P}} {{{ {(n_1)}} _k}} {{{ v} ^k}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^k}} {{{ B} ^l}} {{{ v} _l}} {{\\frac{1}{{\\mu_0}}}}} + {{{{ {(n_1)}} _k}} {{{ B} ^l}} {{{ B} ^m}} {{{ v} ^k}} {{{{ g} _l} _m}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\frac{1}{2}}} {{\\rho}} \\cdot {{{ {(n_1)}} _k}} {{{ v} ^k}} {{{ v} ^l}} {{{ v} ^m}} {{{{ g} _l} _m}}}}\\right) &amp;  {\\frac{\\partial}{\\partial { B} ^j}}\\left({{{{P}} {{{ {(n_1)}} _k}} {{{ v} ^k}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{P}} {{{ {(n_1)}} _k}} {{{ v} ^k}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^k}} {{{ B} ^l}} {{{ v} _l}} {{\\frac{1}{{\\mu_0}}}}} + {{{{ {(n_1)}} _k}} {{{ B} ^l}} {{{ B} ^m}} {{{ v} ^k}} {{{{ g} _l} _m}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\frac{1}{2}}} {{\\rho}} \\cdot {{{ {(n_1)}} _k}} {{{ v} ^k}} {{{ v} ^l}} {{{ v} ^m}} {{{{ g} _l} _m}}}}\\right) &amp;  {\\frac{\\partial}{\\partial P}}\\left({{{{P}} {{{ {(n_1)}} _k}} {{{ v} ^k}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{P}} {{{ {(n_1)}} _k}} {{{ v} ^k}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^k}} {{{ B} ^l}} {{{ v} _l}} {{\\frac{1}{{\\mu_0}}}}} + {{{{ {(n_1)}} _k}} {{{ B} ^l}} {{{ B} ^m}} {{{ v} ^k}} {{{{ g} _l} _m}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\frac{1}{2}}} {{\\rho}} \\cdot {{{ {(n_1)}} _k}} {{{ v} ^k}} {{{ v} ^l}} {{{ v} ^m}} {{{{ g} _l} _m}}}}\\right)\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=66},
	{hidden=false, input="dF_dW_def = dF_dW_def:simplifyMetrics():simplifyAddMulDiv()\nprint(F'^I':diff(W'^J'):eq(dF_dW_def));", output="${\\frac{\\partial { F} ^I}{\\partial { W} ^J}} = {\\left[\\begin{matrix}  {{{ {(n_1)}} _k}} {{{ v} ^k}} &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _j}} &amp;  0 &amp;  0 \\\\  {{{ {(n_1)}} _k}} {{{ v} ^i}} {{{ v} ^k}} &amp;  {{{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _k}} {{{ v} ^k}} {{{{ δ} ^i} _j}}} &amp;  {{{{ {(n_1)}} ^i}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^i}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^k}} {{{{ δ} ^i} _j}} {{\\frac{1}{{\\mu_0}}}}} &amp;  { {(n_1)}} ^i \\\\  0 &amp;  {{{{ {(n_1)}} _j}} {{{ B} ^i}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^k}} {{{{ δ} ^i} _j}}} &amp;  {{{-1}} {{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{{ {(n_1)}} _k}} {{{ v} ^k}} {{{{ δ} ^i} _j}}} &amp;  0 \\\\  {{\\frac{1}{2}}} {{{ {(n_1)}} _k}} {{{ v} ^k}} {{{ v} _m}} {{{ v} ^m}} &amp;  {{{P}} {{{ {(n_1)}} _j}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{P}} {{{ {(n_1)}} _j}}} + {{{{ {(n_1)}} _j}} {{{ B} ^m}} {{{ B} _m}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} _j}} {{{ B} ^k}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\frac{1}{2}}} {{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^m}} {{{ v} _m}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _k}} {{{ v} _j}} {{{ v} ^k}}} &amp;  {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^l}} {{{ v} _l}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^k}} {{{ v} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{2}} {{{ {(n_1)}} _k}} {{{ B} _j}} {{{ v} ^k}} {{\\frac{1}{{\\mu_0}}}}} &amp;  {{{{ {(n_1)}} _k}} {{{ v} ^k}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{{ {(n_1)}} _k}} {{{ v} ^k}}}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=67},
	{hidden=false, input="dF_dW_def = dF_dW_def:tidyIndexes():simplifyAddMulDiv()\nprint(F'^I':diff(W'^J'):eq(dF_dW_def));", output="${\\frac{\\partial { F} ^I}{\\partial { W} ^J}} = {\\left[\\begin{matrix}  {{{ {(n_1)}} _a}} {{{ v} ^a}} &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _j}} &amp;  0 &amp;  0 \\\\  {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^i}} &amp;  {{{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}}} &amp;  {{{{ {(n_1)}} ^i}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^i}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _j}} {{\\frac{1}{{\\mu_0}}}}} &amp;  { {(n_1)}} ^i \\\\  0 &amp;  {{{{ {(n_1)}} _j}} {{{ B} ^i}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _j}}} &amp;  {{{-1}} {{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}}} &amp;  0 \\\\  {{\\frac{1}{2}}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} _b}} {{{ v} ^b}} &amp;  {{{P}} {{{ {(n_1)}} _j}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{P}} {{{ {(n_1)}} _j}}} + {{{{ {(n_1)}} _j}} {{{ B} ^a}} {{{ B} _a}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\frac{1}{2}}} {{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^a}} {{{ v} _a}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} _j}}} &amp;  {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ v} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^a}} {{{ v} _a}} {{\\frac{1}{{\\mu_0}}}}} + {{{2}} {{{ {(n_1)}} _a}} {{{ B} _j}} {{{ v} ^a}} {{\\frac{1}{{\\mu_0}}}}} &amp;  {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}}}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=68},
	{hidden=false, input="-- doesn't work for all indexes, only 'a's\n--dF_dW_def = dF_dW_def:replaceIndex(v'^a' * v'_a', vSq_var)\n-- instead:\ndF_dW_def = dF_dW_def\n\9:replace(v'^a' * v'_a', vSq_var)\n\9:replace(v'^b' * v'_b', vSq_var)\n\9:replace(B'^a' * B'_a', BSq_var)\nprint(F'^I':diff(W'^J'):eq(dF_dW_def));", output="${\\frac{\\partial { F} ^I}{\\partial { W} ^J}} = {\\left[\\begin{matrix}  {{{ {(n_1)}} _a}} {{{ v} ^a}} &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _j}} &amp;  0 &amp;  0 \\\\  {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^i}} &amp;  {{{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}}} &amp;  {{{{ {(n_1)}} ^i}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^i}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _j}} {{\\frac{1}{{\\mu_0}}}}} &amp;  { {(n_1)}} ^i \\\\  0 &amp;  {{{{ {(n_1)}} _j}} {{{ B} ^i}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _j}}} &amp;  {{{-1}} {{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}}} &amp;  0 \\\\  {{\\frac{1}{2}}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{(v)^2}}} &amp;  {{{P}} {{{ {(n_1)}} _j}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{P}} {{{ {(n_1)}} _j}}} + {{{{ {(n_1)}} _j}} {{\\frac{1}{{\\mu_0}}}} {{{(B)^2}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\frac{1}{2}}} {{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{(v)^2}}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} _j}}} &amp;  {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ v} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^a}} {{{ v} _a}} {{\\frac{1}{{\\mu_0}}}}} + {{{2}} {{{ {(n_1)}} _a}} {{{ B} _j}} {{{ v} ^a}} {{\\frac{1}{{\\mu_0}}}}} &amp;  {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}}}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=69},
	{hidden=false, input="dF_dW_def = dF_dW_def \n\9:subst(H_total_with_mag_wrt_W:solve(P), gammaMinusOne_def)()\n\9:subst(gammaMinusOne_def:solve(gamma))\n\9:replace(vSq_var, v'^b' * v'_b')\ndF_dW_def = dF_dW_def:simplifyAddMulDiv():tidyIndexes()\ndF_dW_def = dF_dW_def:simplifyAddMulDiv()\nprint(F'^I':diff(W'^J'):eq(dF_dW_def));", output="${\\frac{\\partial { F} ^I}{\\partial { W} ^J}} = {\\left[\\begin{matrix}  {{{ {(n_1)}} _a}} {{{ v} ^a}} &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _j}} &amp;  0 &amp;  0 \\\\  {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^i}} &amp;  {{{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}}} &amp;  {{{{ {(n_1)}} ^i}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^i}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _j}} {{\\frac{1}{{\\mu_0}}}}} &amp;  { {(n_1)}} ^i \\\\  0 &amp;  {{{{ {(n_1)}} _j}} {{{ B} ^i}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _j}}} &amp;  {{{-1}} {{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}}} &amp;  0 \\\\  {{\\frac{1}{2}}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^b}} {{{ v} _b}} &amp;  {{{{H_{MHD}}}} \\cdot {{{ {(n_1)}} _j}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} _j}}} &amp;  {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ v} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^a}} {{{ v} _a}} {{\\frac{1}{{\\mu_0}}}}} + {{{2}} {{{ {(n_1)}} _a}} {{{ B} _j}} {{{ v} ^a}} {{\\frac{1}{{\\mu_0}}}}} &amp;  {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}}}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=70},
	{hidden=false, input="print'Flux derivative wrt conserved variables:'\nprint(F'^I':diff(U'^J'):eq(F'^I':diff(W'^L') * W'^L':diff(U'^J')));", output="Flux derivative wrt conserved variables:<br>\n${\\frac{\\partial { F} ^I}{\\partial { U} ^J}} = {{{\\frac{\\partial { F} ^I}{\\partial { W} ^L}}} {{\\frac{\\partial { W} ^L}{\\partial { U} ^J}}}}$<br>\n", outputtype="html", uid=71},
	{hidden=false, input="dF_dU_def = dF_dW_def:reindex{j='k'} * dW_dU_def:reindex{ikl='kmn'}\nprint(F'^I':diff(U'^J'):eq(dF_dU_def));", output="${\\frac{\\partial { F} ^I}{\\partial { U} ^J}} = { {\\left[\\begin{matrix}  {{{ {(n_1)}} _a}} {{{ v} ^a}} &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _k}} &amp;  0 &amp;  0 \\\\  {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^i}} &amp;  {{{\\rho}} \\cdot {{{ {(n_1)}} _k}} {{{ v} ^i}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _k}}} &amp;  {{{{ {(n_1)}} ^i}} {{{ B} _k}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^i}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _k}} {{\\frac{1}{{\\mu_0}}}}} &amp;  { {(n_1)}} ^i \\\\  0 &amp;  {{{{ {(n_1)}} _k}} {{{ B} ^i}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _k}}} &amp;  {{{-1}} {{{ {(n_1)}} _k}} {{{ v} ^i}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _k}}} &amp;  0 \\\\  {{\\frac{1}{2}}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^b}} {{{ v} _b}} &amp;  {{{{H_{MHD}}}} \\cdot {{{ {(n_1)}} _k}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} _k}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} _k}}} &amp;  {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ v} _k}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^a}} {{{ v} _a}} {{\\frac{1}{{\\mu_0}}}}} + {{{2}} {{{ {(n_1)}} _a}} {{{ B} _k}} {{{ v} ^a}} {{\\frac{1}{{\\mu_0}}}}} &amp;  {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}}}\\end{matrix}\\right]}  {\\left[\\begin{matrix}  1 &amp;  0 &amp;  0 &amp;  0 \\\\  {\\frac{1}{\\rho}}{\\left({-{{ v} ^k}}\\right)} &amp;  {\\frac{1}{\\rho}} {{{ δ} ^k} _j} &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  {{ δ} ^k} _j &amp;  0 \\\\  {{\\frac{1}{2}}} {{{(\\gamma_{-1})}}} \\cdot {{{ v} ^m}} {{{ v} ^n}} {{{{ g} _m} _n}} &amp;   {-{{(\\gamma_{-1})}}} {{{ v} _j}} &amp;  {{{\\frac{1}{{\\mu_0}}}{\\left({-{{(\\gamma_{-1})}}}\\right)}}} {{{ B} _j}} &amp;  {(\\gamma_{-1})}\\end{matrix}\\right]}}$<br>\n", outputtype="html", uid=72},
	{hidden=false, input="dF_dU_def = dF_dU_def:simplifyAddMulDiv()\nprint(F'^I':diff(U'^J'):eq(dF_dU_def));", output="${\\frac{\\partial { F} ^I}{\\partial { U} ^J}} = {\\left[\\begin{matrix}  {{{{ {(n_1)}} _a}} {{{ v} ^a}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ v} ^k}}} &amp;  {{{ {(n_1)}} _k}} {{{{ δ} ^k} _j}} &amp;  0 &amp;  0 \\\\  {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^i}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ v} ^i}} {{{ v} ^k}}} + {{{\\frac{1}{2}}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} {{{ v} ^m}} {{{ v} ^n}} {{{{ g} _m} _n}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^k}} {{{{ δ} ^i} _k}}} &amp;  {{{-1}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} {{{ v} _j}}} + {{{{ {(n_1)}} _k}} {{{ v} ^i}} {{{{ δ} ^k} _j}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _k}} {{{{ δ} ^k} _j}}} &amp;  {{{-1}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{{ {(n_1)}} ^i}} {{{ B} _k}} {{{{ δ} ^k} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^i}} {{{{ δ} ^k} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _k}} {{{{ δ} ^k} _j}} {{\\frac{1}{{\\mu_0}}}}} &amp;  {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} \\\\  {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^i}} {{{ v} ^k}} {{\\frac{1}{\\rho}}}} + {{{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ v} ^k}} {{{{ δ} ^i} _k}} {{\\frac{1}{\\rho}}}} &amp;  {{{{ {(n_1)}} _k}} {{{ B} ^i}} {{{{ δ} ^k} _j}} {{\\frac{1}{\\rho}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _k}} {{{{ δ} ^k} _j}} {{\\frac{1}{\\rho}}}} &amp;  {{{-1}} {{{ {(n_1)}} _k}} {{{ v} ^i}} {{{{ δ} ^k} _j}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _k}} {{{{ δ} ^k} _j}}} &amp;  0 \\\\  {{{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} _k}} {{{ v} ^k}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {{{-1}} {{{H_{MHD}}}} \\cdot {{{ {(n_1)}} _k}} {{{ v} ^k}} {{\\frac{1}{\\rho}}}} + {{{\\frac{1}{2}}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^b}} {{{ v} _b}}} + {{{\\frac{1}{2}}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^m}} {{{ v} ^n}} {{{{ g} _m} _n}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} _k}} {{{ v} ^k}}} + {{{\\frac{1}{2}}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^m}} {{{ v} ^n}} {{{{ g} _m} _n}}} &amp;  {{{{H_{MHD}}}} \\cdot {{{ {(n_1)}} _k}} {{{{ δ} ^k} _j}} {{\\frac{1}{\\rho}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} _k}} {{{{ δ} ^k} _j}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} _j}}} + {{{-1}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} _j}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} _k}} {{{{ δ} ^k} _j}}} &amp;  {{{-1}} {{{ {(n_1)}} _a}} {{{ B} _j}} {{{ v} ^a}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ B} _j}} {{{ v} ^a}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ v} _k}} {{{{ δ} ^k} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _k}} {{{ B} ^a}} {{{ v} _a}} {{{{ δ} ^k} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{2}} {{{ {(n_1)}} _a}} {{{ B} _k}} {{{ v} ^a}} {{{{ δ} ^k} _j}} {{\\frac{1}{{\\mu_0}}}}} &amp;  {{{{ {(n_1)}} _a}} {{{ v} ^a}}} + {{{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}}}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=73},
	{hidden=false, input="dF_dU_def = dF_dU_def:tidyIndexes()()\ndF_dU_def = dF_dU_def:simplifyMetrics():simplifyAddMulDiv()\ndF_dU_def = dF_dU_def:tidyIndexes():simplifyAddMulDiv()\nprint(F'^I':diff(U'^J'):eq(dF_dU_def));", output="${\\frac{\\partial { F} ^I}{\\partial { U} ^J}} = {\\left[\\begin{matrix}  0 &amp;  { {(n_1)}} _j &amp;  0 &amp;  0 \\\\  {{{\\frac{1}{2}}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} {{{ v} ^a}} {{{ v} _a}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^i}}} &amp;  {{{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{-1}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} {{{ v} _j}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}}} &amp;  {{{{ {(n_1)}} ^i}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^i}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _j}} {{\\frac{1}{{\\mu_0}}}}} &amp;  {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} \\\\  {{{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ v} ^i}} {{\\frac{1}{\\rho}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^i}} {{{ v} ^a}} {{\\frac{1}{\\rho}}}} &amp;  {{{{ {(n_1)}} _j}} {{{ B} ^i}} {{\\frac{1}{\\rho}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _j}} {{\\frac{1}{\\rho}}}} &amp;  {{{-1}} {{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}}} &amp;  0 \\\\  {{{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} _b}} {{{ v} ^b}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {{{-1}} {{{H_{MHD}}}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{\\frac{1}{\\rho}}}} + {{{\\frac{1}{2}}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} _b}} {{{ v} ^b}}} &amp;  {{{{H_{MHD}}}} \\cdot {{{ {(n_1)}} _j}} {{\\frac{1}{\\rho}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {{{-1}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} _j}}} &amp;  {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ v} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{{ {(n_1)}} _a}} {{{ B} _j}} {{{ v} ^a}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^a}} {{{ v} _a}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ B} _j}} {{{ v} ^a}} {{\\frac{1}{{\\mu_0}}}}} &amp;  {{{{ {(n_1)}} _a}} {{{ v} ^a}}} + {{{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}}}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=74},
	{hidden=false, input="print[[Flux derivative matrix times state.  If $\\frac{\\partial F}{\\partial U} \\cdot U = F$ then the equation is said to have the Homogeneity property (Toro proposition 3.4).]]", output="Flux derivative matrix times state.  If $\\frac{\\partial F}{\\partial U} \\cdot U = F$ then the equation is said to have the Homogeneity property (Toro proposition 3.4).<br>\n", outputtype="html", uid=75},
	{hidden=false, input="dF_dU_times_U_def = dF_dU_def * U_def:reindex{i='j'}\nprint((F'^I':diff(U'^J') * U):eq(dF_dU_times_U_def));", output="${{{\\frac{\\partial { F} ^I}{\\partial { U} ^J}}} {{U}}} = { {\\left[\\begin{matrix}  0 &amp;  { {(n_1)}} _j &amp;  0 &amp;  0 \\\\  {{{\\frac{1}{2}}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} {{{ v} ^a}} {{{ v} _a}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^i}}} &amp;  {{{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{-1}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} {{{ v} _j}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}}} &amp;  {{{{ {(n_1)}} ^i}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^i}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _j}} {{\\frac{1}{{\\mu_0}}}}} &amp;  {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} \\\\  {{{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ v} ^i}} {{\\frac{1}{\\rho}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^i}} {{{ v} ^a}} {{\\frac{1}{\\rho}}}} &amp;  {{{{ {(n_1)}} _j}} {{{ B} ^i}} {{\\frac{1}{\\rho}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _j}} {{\\frac{1}{\\rho}}}} &amp;  {{{-1}} {{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}}} &amp;  0 \\\\  {{{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} _b}} {{{ v} ^b}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {{{-1}} {{{H_{MHD}}}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{\\frac{1}{\\rho}}}} + {{{\\frac{1}{2}}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} _b}} {{{ v} ^b}}} &amp;  {{{{H_{MHD}}}} \\cdot {{{ {(n_1)}} _j}} {{\\frac{1}{\\rho}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {{{-1}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} _j}}} &amp;  {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ v} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{{ {(n_1)}} _a}} {{{ B} _j}} {{{ v} ^a}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^a}} {{{ v} _a}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ B} _j}} {{{ v} ^a}} {{\\frac{1}{{\\mu_0}}}}} &amp;  {{{{ {(n_1)}} _a}} {{{ v} ^a}}} + {{{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}}}\\end{matrix}\\right]}  {\\left[\\begin{matrix}  \\rho \\\\  { p} ^j \\\\  { B} ^j \\\\  {E_{MHD}}\\end{matrix}\\right]}}$<br>\n", outputtype="html", uid=76},
	{hidden=false, input="dF_dU_times_U_def = dF_dU_times_U_def:subst(\n\9H_total_with_mag_wrt_W,\n\9p_from_v:reindex{i='j'},\n\9E_total_with_mag_def,\n\9E_mag_def,\n\9P_total_with_mag_def, P_mag_def, e_kin_def, vSq_def, e_int_def, BSq_def)\nprint((F'^I':diff(U'^J') * U):eq(dF_dU_times_U_def));", output="${{{\\frac{\\partial { F} ^I}{\\partial { U} ^J}}} {{U}}} = { {\\left[\\begin{matrix}  0 &amp;  { {(n_1)}} _j &amp;  0 &amp;  0 \\\\  {{{\\frac{1}{2}}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} {{{ v} ^a}} {{{ v} _a}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^i}}} &amp;  {{{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{-1}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} {{{ v} _j}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}}} &amp;  {{{{ {(n_1)}} ^i}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^i}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _j}} {{\\frac{1}{{\\mu_0}}}}} &amp;  {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} \\\\  {{{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ v} ^i}} {{\\frac{1}{\\rho}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^i}} {{{ v} ^a}} {{\\frac{1}{\\rho}}}} &amp;  {{{{ {(n_1)}} _j}} {{{ B} ^i}} {{\\frac{1}{\\rho}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _j}} {{\\frac{1}{\\rho}}}} &amp;  {{{-1}} {{{ {(n_1)}} _j}} {{{ v} ^i}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}}} &amp;  0 \\\\  {{{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} _b}} {{{ v} ^b}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{\\frac{1}{\\rho}}} {{\\left({{{{\\frac{1}{{\\mu_0}}}} {{{{{ B} ^k}} {{{ B} ^l}} {{{{ g} _k} _l}}}}} + {{{P}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {P} + {{{\\frac{1}{2}}} {{\\rho}} \\cdot {{{{{ v} ^k}} {{{ v} ^l}} {{{{ g} _k} _l}}}}}}\\right)}}} + {{{\\frac{1}{2}}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} _b}} {{{ v} ^b}}} &amp;  {{{{ {(n_1)}} _j}} {{\\frac{1}{\\rho}}} {{\\left({{{{\\frac{1}{{\\mu_0}}}} {{{{{ B} ^k}} {{{ B} ^l}} {{{{ g} _k} _l}}}}} + {{{P}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {P} + {{{\\frac{1}{2}}} {{\\rho}} \\cdot {{{{{ v} ^k}} {{{ v} ^l}} {{{{ g} _k} _l}}}}}}\\right)}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {{{-1}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} _j}}} &amp;  {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ v} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{{ {(n_1)}} _a}} {{{ B} _j}} {{{ v} ^a}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^a}} {{{ v} _a}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ B} _j}} {{{ v} ^a}} {{\\frac{1}{{\\mu_0}}}}} &amp;  {{{{ {(n_1)}} _a}} {{{ v} ^a}}} + {{{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}}}\\end{matrix}\\right]}  {\\left[\\begin{matrix}  \\rho \\\\  {{\\rho}} \\cdot {{{ v} ^j}} \\\\  { B} ^j \\\\  {{{\\rho}} \\cdot {{\\left({{{{\\frac{1}{2}}} {{{ v} ^k}} {{{ v} ^l}} {{{{ g} _k} _l}}} + {\\frac{P}{{{{(\\gamma_{-1})}}} \\cdot {{\\rho}}}}}\\right)}}} + {{\\frac{1}{{\\mu_0}}} {{{\\frac{1}{2}}} {{{{{ B} ^k}} {{{ B} ^l}} {{{{ g} _k} _l}}}}}}\\end{matrix}\\right]}}$<br>\n", outputtype="html", uid=77},
	{hidden=false, input="dF_dU_times_U_def = dF_dU_times_U_def()\nprint((F'^I':diff(U'^J') * U):eq(dF_dU_times_U_def));", output="${{{\\frac{\\partial { F} ^I}{\\partial { U} ^J}}} {{U}}} = {\\left[\\begin{matrix}  {{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^j}} \\\\  \\frac{{{{2}} {{P}} {{{\\mu_0}}} \\cdot {{{ {(n_1)}} ^i}}} + {{{2}} {{{ {(n_1)}} ^i}} {{{ B} ^j}} {{{ B} _j}}}{-{{{2}} {{{ {(n_1)}} _j}} {{{ B} ^i}} {{{ B} ^j}}}} + {{{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} {{{ B} ^k}} {{{ B} ^l}} {{{{ g} _k} _l}}}{-{{{2}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} {{{ B} ^j}} {{{ B} _j}}}}{-{{{2}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} ^j}} {{{{ δ} ^i} _j}}}} + {{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^i}} {{{ v} ^j}}} + {{{{(\\gamma_{-1})}}} \\cdot {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{ {(n_1)}} ^i}} {{{ v} ^a}} {{{ v} _a}}}{-{{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^i}}}} + {{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^j}} {{{{ δ} ^i} _j}}}{-{{{2}} {{{(\\gamma_{-1})}}} \\cdot {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{ {(n_1)}} ^i}} {{{ v} ^j}} {{{ v} _j}}}} + {{{{(\\gamma_{-1})}}} \\cdot {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{ {(n_1)}} ^i}} {{{ v} ^k}} {{{ v} ^l}} {{{{ g} _k} _l}}}}{{{2}} {{{\\mu_0}}}} \\\\  {{{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ v} ^i}}}{-{{{{ {(n_1)}} _a}} {{{ B} ^i}} {{{ v} ^a}}}} + {{{{ {(n_1)}} _j}} {{{ B} ^i}} {{{ v} ^j}}}{-{{{{ {(n_1)}} _j}} {{{ B} ^j}} {{{ v} ^i}}}}{-{{{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ v} ^j}} {{{{ δ} ^i} _j}}}} + {{{{ {(n_1)}} _a}} {{{ B} ^j}} {{{ v} ^a}} {{{{ δ} ^i} _j}}} \\\\  \\frac{{{{2}} {{P}} {{{\\mu_0}}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^j}}} + {{{2}} {{{(\\gamma_{-1})}}} \\cdot {{P}} {{{\\mu_0}}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^j}}} + {{{2}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} _b}} {{{ v} ^b}}} + {{{2}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ B} ^j}} {{{ B} _j}} {{{ v} ^a}}}{-{{{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ B} ^k}} {{{ B} ^l}} {{{ v} ^a}} {{{{ g} _k} _l}}}} + {{{{ {(n_1)}} _a}} {{{ B} ^k}} {{{ B} ^l}} {{{ v} ^a}} {{{{ g} _k} _l}} {{{{(\\gamma_{-1})}}^{2}}}}{-{{{2}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} ^j}} {{{ v} _j}}}}{-{{{2}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} _j}} {{{ v} ^j}}}}{-{{{2}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _j}} {{{ B} ^a}} {{{ B} ^j}} {{{ v} _a}}}}{-{{{2}} {{{ {(n_1)}} _a}} {{{ B} _j}} {{{ B} ^j}} {{{ v} ^a}} {{{{(\\gamma_{-1})}}^{2}}}}} + {{{2}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _j}} {{{ B} ^k}} {{{ B} ^l}} {{{ v} ^j}} {{{{ g} _k} _l}}} + {{{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^b}} {{{ v} _b}} {{{{(\\gamma_{-1})}}^{2}}}} + {{{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^k}} {{{ v} ^l}} {{{{ g} _k} _l}} {{{{(\\gamma_{-1})}}^{2}}}}{-{{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^j}} {{{ v} _j}} {{{{(\\gamma_{-1})}}^{2}}}}} + {{{{(\\gamma_{-1})}}} \\cdot {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^j}} {{{ v} ^k}} {{{ v} ^l}} {{{{ g} _k} _l}}}}{{{2}} {{{(\\gamma_{-1})}}} \\cdot {{{\\mu_0}}}}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=78},
	{hidden=false, input="dF_dU_times_U_def = dF_dU_times_U_def\n\9:simplifyMetrics()\n\9:tidyIndexes()\n\9:reindex{ab='jk'}\n\9:replace(v'_k', g'_kl' * v'^l')\n\9:replace(B'_k', g'_kl' * B'^l')\n\9:simplifyAddMulDiv()\nprint((F'^I':diff(U'^J') * U):eq(dF_dU_times_U_def));", output="${{{\\frac{\\partial { F} ^I}{\\partial { U} ^J}}} {{U}}} = {\\left[\\begin{matrix}  {{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^j}} \\\\  {{{P}} {{{ {(n_1)}} ^i}}} + {{{{ {(n_1)}} ^i}} {{{ B} ^j}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} \\cdot {{\\frac{1}{2}}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^i}} {{{ B} _j}} {{{ B} ^j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-2}} {{{ {(n_1)}} _j}} {{{ B} ^i}} {{{ B} ^j}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^i}} {{{ v} ^j}}} \\\\  {{{{ {(n_1)}} _j}} {{{ B} ^i}} {{{ v} ^j}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^j}} {{{ v} ^i}}} \\\\  {{{P}} {{{ {(n_1)}} _j}} {{{ v} ^j}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{P}} {{{ {(n_1)}} _j}} {{{ v} ^j}}} + {{{-1}} \\cdot {{\\frac{1}{2}}} {{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _j}} {{{ B} ^k}} {{{ B} ^l}} {{{ v} ^j}} {{{{ g} _k} _l}} {{\\frac{1}{{\\mu_0}}}}} + {{{3}} \\cdot {{\\frac{1}{2}}} {{{ {(n_1)}} _j}} {{{ B} ^k}} {{{ B} ^l}} {{{ v} ^j}} {{{{ g} _k} _l}} {{\\frac{1}{{\\mu_0}}}}} + {{{-2}} {{{ {(n_1)}} _j}} {{{ B} ^j}} {{{ B} ^k}} {{{ v} ^l}} {{{{ g} _k} _l}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\frac{1}{2}}} {{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^j}} {{{ v} ^k}} {{{ v} ^l}} {{{{ g} _k} _l}}}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=79},
	{hidden=false, input="print(F'^I':eq(F_def));", output="${{ F} ^I} = {\\left[\\begin{matrix}  {{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^j}} \\\\  {{{P}} {{{ {(n_1)}} ^i}}} + {{{\\frac{1}{2}}} {{{ {(n_1)}} ^i}} {{{ B} ^k}} {{{ B} ^l}} {{{{ g} _k} _l}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^i}} {{{ B} ^j}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^i}} {{{ v} ^j}}} \\\\  {{{{ {(n_1)}} _j}} {{{ B} ^i}} {{{ v} ^j}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^j}} {{{ v} ^i}}} \\\\  {{{P}} {{{ {(n_1)}} _j}} {{{ v} ^j}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{P}} {{{ {(n_1)}} _j}} {{{ v} ^j}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^j}} {{{ B} ^k}} {{{ v} _k}} {{\\frac{1}{{\\mu_0}}}}} + {{{{ {(n_1)}} _j}} {{{ B} ^k}} {{{ B} ^l}} {{{ v} ^j}} {{{{ g} _k} _l}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\frac{1}{2}}} {{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^j}} {{{ v} ^k}} {{{ v} ^l}} {{{{ g} _k} _l}}}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=80},
	{hidden=false, input="'either I have some math substituttions wrong or this fails the homogeneity condition'", output="either I have some math substituttions wrong or this fails the homogeneity condition", outputtype="html", uid=81},
	{hidden=false, input="print'Acoustic matrix:'", output="Acoustic matrix:<br>\n", outputtype="html", uid=82},
	{hidden=false, input="A_lhs = A'^I_J' + n'_a' * v'^a' * delta'^I_J'\nprint(A_lhs:eq(W'^I':diff(U'^K') * F'^K':diff(W'^J')));", output="${{{{ A} ^I} _J} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^I} _J}}}} = {{{\\frac{\\partial { W} ^I}{\\partial { U} ^K}}} {{\\frac{\\partial { F} ^K}{\\partial { W} ^J}}}}$<br>\n", outputtype="html", uid=83},
	{hidden=false, input="A_plus_delta_def = dW_dU_def:reindex{jk='km'} * dF_dW_def:reindex{ik='kn'}\nprint(A_lhs:eq(A_plus_delta_def));", output="${{{{ A} ^I} _J} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^I} _J}}}} = { {\\left[\\begin{matrix}  1 &amp;  0 &amp;  0 &amp;  0 \\\\  {\\frac{1}{\\rho}}{\\left({-{{ v} ^i}}\\right)} &amp;  {\\frac{1}{\\rho}} {{{ δ} ^i} _k} &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  {{ δ} ^i} _k &amp;  0 \\\\  {{\\frac{1}{2}}} {{{(\\gamma_{-1})}}} \\cdot {{{ v} ^m}} {{{ v} ^l}} {{{{ g} _m} _l}} &amp;   {-{{(\\gamma_{-1})}}} {{{ v} _k}} &amp;  {{{\\frac{1}{{\\mu_0}}}{\\left({-{{(\\gamma_{-1})}}}\\right)}}} {{{ B} _k}} &amp;  {(\\gamma_{-1})}\\end{matrix}\\right]}  {\\left[\\begin{matrix}  {{{ {(n_1)}} _a}} {{{ v} ^a}} &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _j}} &amp;  0 &amp;  0 \\\\  {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^k}} &amp;  {{{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^k}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^k} _j}}} &amp;  {{{{ {(n_1)}} ^k}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^k}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^k} _j}} {{\\frac{1}{{\\mu_0}}}}} &amp;  { {(n_1)}} ^k \\\\  0 &amp;  {{{{ {(n_1)}} _j}} {{{ B} ^k}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^k} _j}}} &amp;  {{{-1}} {{{ {(n_1)}} _j}} {{{ v} ^k}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^k} _j}}} &amp;  0 \\\\  {{\\frac{1}{2}}} {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} ^b}} {{{ v} _b}} &amp;  {{{{H_{MHD}}}} \\cdot {{{ {(n_1)}} _j}}} + {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{\\rho}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} _j}}} &amp;  {{{-1}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ v} _j}} {{\\frac{1}{{\\mu_0}}}}} + {{{-1}} {{{ {(n_1)}} _j}} {{{ B} ^a}} {{{ v} _a}} {{\\frac{1}{{\\mu_0}}}}} + {{{2}} {{{ {(n_1)}} _a}} {{{ B} _j}} {{{ v} ^a}} {{\\frac{1}{{\\mu_0}}}}} &amp;  {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{\\frac{1}{{(\\gamma_{-1})}}}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}}}\\end{matrix}\\right]}}$<br>\n", outputtype="html", uid=84},
	{hidden=false, input="A_plus_delta_def = A_plus_delta_def()\nprint(A_lhs:eq(A_plus_delta_def));", output="${{{{ A} ^I} _J} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^I} _J}}}} = {\\left[\\begin{matrix}  {{{ {(n_1)}} _a}} {{{ v} ^a}} &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _j}} &amp;  0 &amp;  0 \\\\  {\\frac{1}{\\rho}} {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{\\left({{-{{ v} ^i}} + {{{{ v} ^k}} {{{{ δ} ^i} _k}}}}\\right)}}} &amp;  {-{{{{ {(n_1)}} _j}} {{{ v} ^i}}}} + {{{{ {(n_1)}} _j}} {{{ v} ^k}} {{{{ δ} ^i} _k}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _k}} {{{{ δ} ^k} _j}}} &amp;  \\frac{{{{{ δ} ^i} _k}} {{\\left({{{{{ {(n_1)}} ^k}} {{{ B} _j}}}{-{{{{ {(n_1)}} _j}} {{{ B} ^k}}}}{-{{{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^k} _j}}}}}\\right)}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  {\\frac{1}{\\rho}} {{{{ {(n_1)}} ^k}} {{{{ δ} ^i} _k}}} \\\\  0 &amp;  {{{{ δ} ^i} _k}} {{\\left({{{{{ {(n_1)}} _j}} {{{ B} ^k}}}{-{{{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^k} _j}}}}}\\right)}} &amp;  {{{{ δ} ^i} _k}} {{\\left({{-{{{{ {(n_1)}} _j}} {{{ v} ^k}}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^k} _j}}}}\\right)}} &amp;  0 \\\\  {\\frac{1}{2}} {{{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{\\left({{{{{ v} ^b}} {{{ v} _b}}} + {{{{ v} ^l}} {{{ v} ^m}} {{{{ g} _m} _l}}}{-{{{2}} {{{ v} ^k}} {{{ v} _k}}}}}\\right)}}} &amp;  \\frac{{{{(\\gamma_{-1})}}} \\cdot {{\\left({{{{2}} {{{H_{MHD}}}} \\cdot {{{\\mu_0}}} \\cdot {{{ {(n_1)}} _j}}}{-{{{2}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} _j}}}}{-{{{2}} {{{ {(n_1)}} _j}} {{{ B} ^k}} {{{ B} _k}}}} + {{{2}} {{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ B} _k}} {{{{ δ} ^k} _j}}} + {{{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^l}} {{{ v} ^m}} {{{{ g} _m} _l}}}{-{{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{ {(n_1)}} _j}} {{{ v} ^k}} {{{ v} _k}}}}{-{{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} _k}} {{{{ δ} ^k} _j}}}} + {{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{ v} _j}}}}\\right)}}}{{{2}} {{{\\mu_0}}}} &amp;  {\\frac{1}{{\\mu_0}}} {{{{(\\gamma_{-1})}}} \\cdot {{\\left({{-{{{{ {(n_1)}} ^k}} {{{ B} _j}} {{{ v} _k}}}}{-{{{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ v} _j}}}}{-{{{{ {(n_1)}} _j}} {{{ B} ^a}} {{{ v} _a}}}} + {{{{ {(n_1)}} _j}} {{{ B} ^k}} {{{ v} _k}}} + {{{{ {(n_1)}} _j}} {{{ B} _k}} {{{ v} ^k}}} + {{{2}} {{{ {(n_1)}} _a}} {{{ B} _j}} {{{ v} ^a}}} + {{{{ {(n_1)}} _a}} {{{ B} ^a}} {{{ v} _k}} {{{{ δ} ^k} _j}}}{-{{{{ {(n_1)}} _a}} {{{ B} _k}} {{{ v} ^a}} {{{{ δ} ^k} _j}}}}}\\right)}}} &amp;  {{{{ {(n_1)}} _a}} {{{ v} ^a}}}{-{{{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} ^k}} {{{ v} _k}}}} + {{{{(\\gamma_{-1})}}} \\cdot {{{ {(n_1)}} _a}} {{{ v} ^a}}}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=85},
	{hidden=false, input="A_plus_delta_def = A_plus_delta_def:simplifyMetrics()\nA_plus_delta_def = A_plus_delta_def:simplifyAddMulDiv()\nA_plus_delta_def = A_plus_delta_def:tidyIndexes()\nA_plus_delta_def = A_plus_delta_def:simplifyAddMulDiv()\nA_plus_delta_def = A_plus_delta_def\n\9:replace(n'^a' * v'_a', n'_a' * v'^a')\n\9:replace(v'^a' * v'_a', vSq_var)\n\9--:replace(n'^j' * B'_j', n'_a' * B'^a')\n\9:replace(B'^a' * B'_a', BSq_var)\n\9:subst(H_total_with_mag_wrt_W, gammaMinusOne_def)()\nprint(A_lhs:eq(A_plus_delta_def));", output="${{{{ A} ^I} _J} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^I} _J}}}} = {\\left[\\begin{matrix}  {{{ {(n_1)}} _a}} {{{ v} ^a}} &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _j}} &amp;  0 &amp;  0 \\\\  0 &amp;  {{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}} &amp;  \\frac{{{{{ {(n_1)}} ^i}} {{{ B} _j}}}{-{{{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _j}}}}{-{{{{ {(n_1)}} _j}} {{{ B} ^i}}}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  {\\frac{1}{\\rho}} {{ {(n_1)}} ^i} \\\\  0 &amp;  {{{{ {(n_1)}} _j}} {{{ B} ^i}}}{-{{{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _j}}}} &amp;  {-{{{{ {(n_1)}} _j}} {{{ v} ^i}}}} + {{{{ {(n_1)}} _a}} {{{ v} ^a}} {{{{ δ} ^i} _j}}} &amp;  0 \\\\  0 &amp;  {{P}} {{\\gamma}} \\cdot {{{ {(n_1)}} _j}} &amp;  {\\frac{1}{{\\mu_0}}} {{{{ {(n_1)}} _j}} {{{ B} _a}} {{{ v} ^a}} {{\\left({{-{1}} + {\\gamma}}\\right)}}} &amp;  {{{ {(n_1)}} _a}} {{{ v} ^a}}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=86},
	{hidden=false, input="A_def = (A_plus_delta_def - Matrix.identity(4) * Matrix:lambda({4,4}, function(i,j)\n\9return i~=j and 0 or (n'_a' * v'^a' * ((i==2 or i==3) and delta'^i_j' or 1)) \nend))()\nprint(A'^I_J':eq(A_def));", output="${{{ A} ^I} _J} = {\\left[\\begin{matrix}  0 &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _j}} &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  \\frac{{{{{ {(n_1)}} ^i}} {{{ B} _j}}}{-{{{{ {(n_1)}} _j}} {{{ B} ^i}}}}{-{{{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _j}}}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  {\\frac{1}{\\rho}} {{ {(n_1)}} ^i} \\\\  0 &amp;  {{{{ {(n_1)}} _j}} {{{ B} ^i}}}{-{{{{ {(n_1)}} _a}} {{{ B} ^a}} {{{{ δ} ^i} _j}}}} &amp;  -{{{{ {(n_1)}} _j}} {{{ v} ^i}}} &amp;  0 \\\\  0 &amp;  {{P}} {{\\gamma}} \\cdot {{{ {(n_1)}} _j}} &amp;  {\\frac{1}{{\\mu_0}}} {{{{ {(n_1)}} _j}} {{{ B} _a}} {{{ v} ^a}} {{\\left({{-{1}} + {\\gamma}}\\right)}}} &amp;  0\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=87},
	{hidden=false, input="function expandMatrix4to8(A)\n\9return Matrix:lambda({8,8}, function(i,j)\n\9\9local remap = {1,2,2,2,3,3,3,4}\n\9\9local replace = {nil, 'x','y','z', 'x','y','z', nil}\n\9\9return A[remap[i]][remap[j]]:map(function(x)\n\9\9\9if x == delta'^i_j' then\n\9\9\9\9return replace[i] == replace[j] and 1 or 0\n\9\9\9end\n\9\9end):map(function(x)\n\9\9\9if Tensor.Index:isa(x) then\n\9\9\9\9if x.symbol == 'i' then\n\9\9\9\9\9x = x:clone()\n\9\9\9\9\9x.symbol = assert(replace[i])\n\9\9\9\9\9return x\n\9\9\9\9elseif x.symbol == 'j' then\n\9\9\9\9\9x = x:clone()\n\9\9\9\9\9x.symbol = assert(replace[j])\n\9\9\9\9\9return x\n\9\9\9\9end\n\9\9\9end\n\9\9end)()\n\9end)\nend", output="", outputtype="html", uid=88},
	{hidden=false, input="print'Acoustic matrix, expanded:'", output="Acoustic matrix, expanded:<br>\n", outputtype="html", uid=89},
	{haserror=true, hidden=false, input="A8_expanded = expandMatrix4to8(A_def)\nprint(A'^I_J':eq(A_expanded));", output="[string \"/home/chris/Projects/lua/symmath/Expression.lua\"]:24: can't initialize an expression with a nil child\nstack traceback:\n\9[string \"../server/standalone.lua\"]:525: in function <[string \"../server/standalone.lua\"]:523>\n\9[C]: in function 'error'\n\9[string \"/home/chris/Projects/lua/symmath/Expression.lua\"]:24: in function 'init'\n\9[string \"/home/chris/Projects/lua/symmath/op/Binary.lua\"]:7: in function 'init'\n\9[string \"/home/chris/Projects/lua/ext/class.lua\"]:7: in function 'eq'\n\9[string \"A8_expanded=expandMatrix4to8(...\"]:2: in main chunk\n\9[string \"../server/standalone.lua\"]:451: in function <[string \"../server/standalone.lua\"]:394>\n\9[C]: in function 'xpcall'\n\9[string \"../server/standalone.lua\"]:394: in function 'runCell'\n\9[string \"../server/standalone.lua\"]:601: in function 'handleRequest'\n\9[string \"/home/chris/Projects/lua/http/class.lua\"]:625: in function <[string \"/home/chris/Projects/lua/http/class.lua\"]:484>\n\9[C]: in function 'xpcall'\n\9[string \"/home/chris/Projects/lua/http/class.lua\"]:484: in function 'handleClient'\n\9[string \"/home/chris/Projects/lua/http/class.lua\"]:722: in function <[string \"/home/chris/Projects/lua/http/class.lua\"]:657>", outputtype="html", uid=90},
	{hidden=false, input="-- TODO ok this is the part where I'm supposed to show the symmetrized dF/dU aka A+nv and show that the 5th entry diagonal is 0 which corresponds to \n-- the egenerate eigenvector ... or just show that in the flux F(B(n)) = dt B(n) = 0, and therefore I can just cut it out of the whole acoustic matrix.", output="", outputtype="html", uid=114},
	{hidden=false, input="A_expanded = Matrix:lambda({7,7}, |i,j| A8_expanded[i + (i>=5 and 1 or 0)][j + (j>=5 and 1 or 0)])\nprint(A'^I_J':eq(A_expanded));", output="${{{ A} ^I} _J} = {\\left[\\begin{matrix}  0 &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _x}} &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _y}} &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _z}} &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  \\frac{{{{{ {(n_1)}} ^x}} {{{ B} _y}}}{-{{{{ {(n_1)}} _y}} {{{ B} ^x}}}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{{{{{ {(n_1)}} ^x}} {{{ B} _z}}}{-{{{{ {(n_1)}} _z}} {{{ B} ^x}}}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  {\\frac{1}{\\rho}} {{ {(n_1)}} ^x} \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  \\frac{{{{{ {(n_1)}} ^y}} {{{ B} _y}}}{-{{{{ {(n_1)}} _a}} {{{ B} ^a}}}}{-{{{{ {(n_1)}} _y}} {{{ B} ^y}}}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{{{{{ {(n_1)}} ^y}} {{{ B} _z}}}{-{{{{ {(n_1)}} _z}} {{{ B} ^y}}}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  {\\frac{1}{\\rho}} {{ {(n_1)}} ^y} \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  \\frac{{{{{ {(n_1)}} ^z}} {{{ B} _y}}}{-{{{{ {(n_1)}} _y}} {{{ B} ^z}}}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{{{{{ {(n_1)}} ^z}} {{{ B} _z}}}{-{{{{ {(n_1)}} _a}} {{{ B} ^a}}}}{-{{{{ {(n_1)}} _z}} {{{ B} ^z}}}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  {\\frac{1}{\\rho}} {{ {(n_1)}} ^z} \\\\  0 &amp;  {{{ {(n_1)}} _x}} {{{ B} ^y}} &amp;  {-{{{{ {(n_1)}} _a}} {{{ B} ^a}}}} + {{{{ {(n_1)}} _y}} {{{ B} ^y}}} &amp;  {{{ {(n_1)}} _z}} {{{ B} ^y}} &amp;  -{{{{ {(n_1)}} _y}} {{{ v} ^y}}} &amp;  -{{{{ {(n_1)}} _z}} {{{ v} ^y}}} &amp;  0 \\\\  0 &amp;  {{{ {(n_1)}} _x}} {{{ B} ^z}} &amp;  {{{ {(n_1)}} _y}} {{{ B} ^z}} &amp;  {-{{{{ {(n_1)}} _a}} {{{ B} ^a}}}} + {{{{ {(n_1)}} _z}} {{{ B} ^z}}} &amp;  -{{{{ {(n_1)}} _y}} {{{ v} ^z}}} &amp;  -{{{{ {(n_1)}} _z}} {{{ v} ^z}}} &amp;  0 \\\\  0 &amp;  {{P}} {{\\gamma}} \\cdot {{{ {(n_1)}} _x}} &amp;  {{P}} {{\\gamma}} \\cdot {{{ {(n_1)}} _y}} &amp;  {{P}} {{\\gamma}} \\cdot {{{ {(n_1)}} _z}} &amp;  {\\frac{1}{{\\mu_0}}} {{{{ {(n_1)}} _y}} {{{ B} _a}} {{{ v} ^a}} {{\\left({{-{1}} + {\\gamma}}\\right)}}} &amp;  {\\frac{1}{{\\mu_0}}} {{{{ {(n_1)}} _z}} {{{ B} _a}} {{{ v} ^a}} {{\\left({{-{1}} + {\\gamma}}\\right)}}} &amp;  0\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=115},
	{hidden=false, input="P_for_Cs = Cs_def:solve(P)\nA_expanded = A_expanded:subst(P_for_Cs)()\nprint(A'^I_J':eq(A_expanded));", output="${{{ A} ^I} _J} = {\\left[\\begin{matrix}  0 &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _x}} &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _y}} &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _z}} &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  \\frac{{{{{ {(n_1)}} ^x}} {{{ B} _y}}}{-{{{{ {(n_1)}} _y}} {{{ B} ^x}}}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{{{{{ {(n_1)}} ^x}} {{{ B} _z}}}{-{{{{ {(n_1)}} _z}} {{{ B} ^x}}}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  {\\frac{1}{\\rho}} {{ {(n_1)}} ^x} \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  \\frac{{{{{ {(n_1)}} ^y}} {{{ B} _y}}}{-{{{{ {(n_1)}} _a}} {{{ B} ^a}}}}{-{{{{ {(n_1)}} _y}} {{{ B} ^y}}}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{{{{{ {(n_1)}} ^y}} {{{ B} _z}}}{-{{{{ {(n_1)}} _z}} {{{ B} ^y}}}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  {\\frac{1}{\\rho}} {{ {(n_1)}} ^y} \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  \\frac{{{{{ {(n_1)}} ^z}} {{{ B} _y}}}{-{{{{ {(n_1)}} _y}} {{{ B} ^z}}}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{{{{{ {(n_1)}} ^z}} {{{ B} _z}}}{-{{{{ {(n_1)}} _a}} {{{ B} ^a}}}}{-{{{{ {(n_1)}} _z}} {{{ B} ^z}}}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  {\\frac{1}{\\rho}} {{ {(n_1)}} ^z} \\\\  0 &amp;  {{{ {(n_1)}} _x}} {{{ B} ^y}} &amp;  {-{{{{ {(n_1)}} _a}} {{{ B} ^a}}}} + {{{{ {(n_1)}} _y}} {{{ B} ^y}}} &amp;  {{{ {(n_1)}} _z}} {{{ B} ^y}} &amp;  -{{{{ {(n_1)}} _y}} {{{ v} ^y}}} &amp;  -{{{{ {(n_1)}} _z}} {{{ v} ^y}}} &amp;  0 \\\\  0 &amp;  {{{ {(n_1)}} _x}} {{{ B} ^z}} &amp;  {{{ {(n_1)}} _y}} {{{ B} ^z}} &amp;  {-{{{{ {(n_1)}} _a}} {{{ B} ^a}}}} + {{{{ {(n_1)}} _z}} {{{ B} ^z}}} &amp;  -{{{{ {(n_1)}} _y}} {{{ v} ^z}}} &amp;  -{{{{ {(n_1)}} _z}} {{{ v} ^z}}} &amp;  0 \\\\  0 &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _x}} {{{{c_s}}^{2}}} &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _y}} {{{{c_s}}^{2}}} &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _z}} {{{{c_s}}^{2}}} &amp;  {\\frac{1}{{\\mu_0}}} {{{{ {(n_1)}} _y}} {{{ B} _a}} {{{ v} ^a}} {{\\left({{-{1}} + {\\gamma}}\\right)}}} &amp;  {\\frac{1}{{\\mu_0}}} {{{{ {(n_1)}} _z}} {{{ B} _a}} {{{ v} ^a}} {{\\left({{-{1}} + {\\gamma}}\\right)}}} &amp;  0\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=91},
	{hidden=false, input="print'...in just the Cartesian x-axis...'\nA_expanded = A_expanded\n\9:replace(n'_x', 1)\n\9:replace(n'_y', 0)\n\9:replace(n'_z', 0)\n\9:replace(n'^x', 1)\n\9:replace(n'^y', 0)\n\9:replace(n'^z', 0)\n\9:replace(n'_a' * B'^a', B'^x')\n--[[ can I automatically expand this? do I need to?\n\9:replace(B'_a' * v'^a', B'^x' * v'_x' + B'^y' * v'_y' + B'^z' * v'_z')\n\9\9:replace(v'_x', g'_xx' * v'^x' + g'_xy' * v'^y' + g'_xz' * v'^z')\n\9\9:replace(v'_y', g'_xy' * v'^x' + g'_yy' * v'^y' + g'_yz' * v'^z')\n\9\9:replace(v'_z', g'_xz' * v'^x' + g'_yz' * v'^y' + g'_zz' * v'^z')\n--]]\n\9:subst(gammaMinusOne_def:solve(gamma))\n\9:replace(B'_x', B'^x')\n\9:replace(B'_y', B'^y')\n\9:replace(B'_z', B'^z')\n\9:simplify()\nprint(A'^I_J':eq(A_expanded));", output="...in just the Cartesian x-axis...<br>\n${{{ A} ^I} _J} = {\\left[\\begin{matrix}  0 &amp;  \\rho &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  \\frac{{ B} ^y}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{{ B} ^z}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{1}{\\rho} \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  -{\\frac{{ B} ^x}{{{{\\mu_0}}} \\cdot {{\\rho}}}} &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  -{\\frac{{ B} ^x}{{{{\\mu_0}}} \\cdot {{\\rho}}}} &amp;  0 \\\\  0 &amp;  { B} ^y &amp;  -{{ B} ^x} &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  { B} ^z &amp;  0 &amp;  -{{ B} ^x} &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  {{\\rho}} \\cdot {{{{c_s}}^{2}}} &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=92},
	{hidden=false, input="A_expanded_wrt_W = A_expanded:subst(Cs_def)()\nprint(A'^I_J':eq(A_expanded_wrt_W));", output="${{{ A} ^I} _J} = {\\left[\\begin{matrix}  0 &amp;  \\rho &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  \\frac{{ B} ^y}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{{ B} ^z}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{1}{\\rho} \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  -{\\frac{{ B} ^x}{{{{\\mu_0}}} \\cdot {{\\rho}}}} &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  -{\\frac{{ B} ^x}{{{{\\mu_0}}} \\cdot {{\\rho}}}} &amp;  0 \\\\  0 &amp;  { B} ^y &amp;  -{{ B} ^x} &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  { B} ^z &amp;  0 &amp;  -{{ B} ^x} &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  {{P}} {{\\gamma}} &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=93},
	{hidden=false, input="print((W'^I_,t' + (A'^I_J' + delta'^I_J' * v'^k') * W'^J_,k'):eq(0));", output="${{{{ W} ^I} _{,t}} + {{{\\left({{{{ A} ^I} _J} + {{{{{ δ} ^I} _J}} {{{ v} ^k}}}}\\right)}} {{{{ W} ^J} _{,k}}}}} = {0}$<br>\n", outputtype="html", uid=94},
	{hidden=false, input="--W_dense = Matrix{rho, v'^x', v'^y', v'^z', B'^x', B'^y', B'^z', P}:T()\nW7_dense = Matrix{rho, v'^x', v'^y', v'^z', B'^y', B'^z', P}:T()", output="$\\left[\\begin{matrix}  \\rho \\\\  { v} ^x \\\\  { v} ^y \\\\  { v} ^z \\\\  { B} ^y \\\\  { B} ^z \\\\  P\\end{matrix}\\right]$", outputtype="html", uid=95},
	{hidden=false, input="eqn = (W7_dense:diff(t) + (A_expanded_wrt_W + v'^x' * Matrix.identity(7)) * W7_dense:diff(x)):eq(Matrix:zeros{7, 1})", output="${{{\\frac{\\partial}{\\partial t}}\\left( \\left[\\begin{matrix}  \\rho \\\\  { v} ^x \\\\  { v} ^y \\\\  { v} ^z \\\\  { B} ^y \\\\  { B} ^z \\\\  P\\end{matrix}\\right]\\right)} + {{{\\left({{\\left[\\begin{matrix}  0 &amp;  \\rho &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  \\frac{{ B} ^y}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{{ B} ^z}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{1}{\\rho} \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  -{\\frac{{ B} ^x}{{{{\\mu_0}}} \\cdot {{\\rho}}}} &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  -{\\frac{{ B} ^x}{{{{\\mu_0}}} \\cdot {{\\rho}}}} &amp;  0 \\\\  0 &amp;  { B} ^y &amp;  -{{ B} ^x} &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  { B} ^z &amp;  0 &amp;  -{{ B} ^x} &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  {{P}} {{\\gamma}} &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0\\end{matrix}\\right]} + {{{{ v} ^x}}  {\\left[\\begin{matrix}  1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  1 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  1 &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  1 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  1\\end{matrix}\\right]}}}\\right)}} {{{\\frac{\\partial}{\\partial x}}\\left( \\left[\\begin{matrix}  \\rho \\\\  { v} ^x \\\\  { v} ^y \\\\  { v} ^z \\\\  { B} ^y \\\\  { B} ^z \\\\  P\\end{matrix}\\right]\\right)}}}} = {\\left[\\begin{matrix}  0 \\\\  0 \\\\  0 \\\\  0 \\\\  0 \\\\  0 \\\\  0\\end{matrix}\\right]}$", outputtype="html", uid=96},
	{hidden=false, input="eqn = eqn:simplifyAddMulDiv()\ndt_W_eqns = eqn:unravel()\nfor _,eqn in ipairs(dt_W_eqns) do\n\9print(eqn)\nend;", output="${{\\frac{\\partial \\rho}{\\partial t}} + {{{\\rho}} \\cdot {{\\frac{\\partial { v} ^x}{\\partial x}}}} + {{{{ v} ^x}} {{\\frac{\\partial \\rho}{\\partial x}}}}} = {0}$<br>\n${{{{\\frac{\\partial P}{\\partial x}}} {{\\frac{1}{\\rho}}}} + {{{{ B} ^y}} {{\\frac{\\partial { B} ^y}{\\partial x}}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {{{{ B} ^z}} {{\\frac{\\partial { B} ^z}{\\partial x}}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {\\frac{\\partial { v} ^x}{\\partial t}} + {{{{ v} ^x}} {{\\frac{\\partial { v} ^x}{\\partial x}}}}} = {0}$<br>\n${{{{-1}} {{{ B} ^x}} {{\\frac{\\partial { B} ^y}{\\partial x}}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {\\frac{\\partial { v} ^y}{\\partial t}} + {{{{ v} ^x}} {{\\frac{\\partial { v} ^y}{\\partial x}}}}} = {0}$<br>\n${{{{-1}} {{{ B} ^x}} {{\\frac{\\partial { B} ^z}{\\partial x}}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {\\frac{\\partial { v} ^z}{\\partial t}} + {{{{ v} ^x}} {{\\frac{\\partial { v} ^z}{\\partial x}}}}} = {0}$<br>\n${{\\frac{\\partial { B} ^y}{\\partial t}} + {{{-1}} {{{ B} ^x}} {{\\frac{\\partial { v} ^y}{\\partial x}}}} + {{{{ B} ^y}} {{\\frac{\\partial { v} ^x}{\\partial x}}}} + {{{{ v} ^x}} {{\\frac{\\partial { B} ^y}{\\partial x}}}}} = {0}$<br>\n${{\\frac{\\partial { B} ^z}{\\partial t}} + {{{-1}} {{{ B} ^x}} {{\\frac{\\partial { v} ^z}{\\partial x}}}} + {{{{ B} ^z}} {{\\frac{\\partial { v} ^x}{\\partial x}}}} + {{{{ v} ^x}} {{\\frac{\\partial { B} ^z}{\\partial x}}}}} = {0}$<br>\n${{\\frac{\\partial P}{\\partial t}} + {{{{ v} ^x}} {{\\frac{\\partial P}{\\partial x}}}} + {{{P}} {{\\gamma}} \\cdot {{\\frac{\\partial { v} ^x}{\\partial x}}}}} = {0}$<br>\n", outputtype="html", uid=97},
	{hidden=false, input="chart = Tensor.Chart{coords=xs}\n;", output="", outputtype="html", uid=98},
	{hidden=false, input="nl_dense = Tensor('_i', function(i) return n('_'..xs[i].name) end)\nnu_dense = Tensor('^i', function(i) return n('^'..xs[i].name) end)\nn2 = var'(n_2)'\nn2l_dense = Tensor('_i', function(i) return n2('_'..xs[i].name) end)\nn2u_dense = Tensor('^i', function(i) return n2('^'..xs[i].name) end)\nn3 = var'(n_3)'\nn3l_dense = Tensor('_i', function(i) return n3('_'..xs[i].name) end)\nn3u_dense = Tensor('^i', function(i) return n3('^'..xs[i].name) end)\n\nnls = {nl_dense, n2l_dense, n3l_dense}\nnus = {nu_dense, n2u_dense, n3u_dense}\n\n-- TODO this is just |n_1|, but in non-Cartesian metric |n_1| != |n_2| != |n_3|\n-- for example, in a coordinate basis, n_i = d/dx^i, so (n_i)_j = delta_ij, so |(n_i) lowered|L2 = 1\n-- and (n_i)^j = g^ij ... in a diagonal metric ... g^ii delta^ij ... so |(n_i) raised|L2 = sqrt(g^ii)\n-- and the metric weighted length: |n_i| = sqrt((n_i)_j (n_i)^j) = sqrt(g^ii)\n-- so as you can see, each separate normal basis has a separate length.  \n-- so much for orthonormalizing.\nn1Len = var'|n_1|'\nn2Len = var'|n_2|'\nn3Len = var'|n_3|'\nn1LenSq_def = (n1Len^2):eq((nl_dense'_i' * nu_dense'^i')())\nn2LenSq_def = (n2Len^2):eq((n2l_dense'_i' * n2u_dense'^i')())\nn3LenSq_def = (n3Len^2):eq((n3l_dense'_i' * n3u_dense'^i')())\nprint(n1LenSq_def)\nprint(n2LenSq_def)\nprint(n3LenSq_def);", output="${{{|n_1|}}^{2}} = {{{{{ {(n_1)}} _x}} {{{ {(n_1)}} ^x}}} + {{{{ {(n_1)}} _y}} {{{ {(n_1)}} ^y}}} + {{{{ {(n_1)}} _z}} {{{ {(n_1)}} ^z}}}}$<br>\n${{{|n_2|}}^{2}} = {{{{{ {(n_2)}} _x}} {{{ {(n_2)}} ^x}}} + {{{{ {(n_2)}} _y}} {{{ {(n_2)}} ^y}}} + {{{{ {(n_2)}} _z}} {{{ {(n_2)}} ^z}}}}$<br>\n${{{|n_3|}}^{2}} = {{{{{ {(n_3)}} _x}} {{{ {(n_3)}} ^x}}} + {{{{ {(n_3)}} _y}} {{{ {(n_3)}} ^y}}} + {{{{ {(n_3)}} _z}} {{{ {(n_3)}} ^z}}}}$<br>\n", outputtype="html", uid=99},
	{hidden=false, input="print[[ $(n_m)_i (n_n)^i = (n_m)_i (n_n)_j g^{ij} = \\delta_{mn} |n_m|^2$ ]]\nprint[[ For $|n_i|$ is the metric-weighted norm. ]];", output=" $(n_m)_i (n_n)^i = (n_m)_i (n_n)_j g^{ij} = \\delta_{mn} |n_m|^2$ <br>\n For $|n_i|$ is the metric-weighted norm. <br>\n", outputtype="html", uid=100},
	{hidden=false, input="Nl_3x3mat = Matrix(\n\9{nl_dense[1], nl_dense[2], nl_dense[3]},\n\9{n2l_dense[1], n2l_dense[2], n2l_dense[3]},\n\9{n3l_dense[1], n3l_dense[2], n3l_dense[3]}\n):T()\nNu_3x3mat = Matrix(\n\9{nu_dense[1], nu_dense[2], nu_dense[3]},\n\9{n2u_dense[1], n2u_dense[2], n2u_dense[3]},\n\9{n3u_dense[1], n3u_dense[2], n3u_dense[3]}\n):T()\n\nprint((var'N^\\\\flat_{3x3}''^T' * var'N^\\\\sharp_{3x3}'):eq(\n\9Nl_3x3mat:T() * Nu_3x3mat\n):eq(\n\9(Nl_3x3mat:T() * Nu_3x3mat)()\n):eq(\n\9Matrix.diagonal(n1Len^2, n2Len^2, n3Len^2)\n));", output="${{{{{{ {N^\\flat_{3x3}}} ^T}} {{{N^\\sharp_{3x3}}}}} = { {\\left[\\begin{matrix}  { {(n_1)}} _x &amp;  { {(n_1)}} _y &amp;  { {(n_1)}} _z \\\\  { {(n_2)}} _x &amp;  { {(n_2)}} _y &amp;  { {(n_2)}} _z \\\\  { {(n_3)}} _x &amp;  { {(n_3)}} _y &amp;  { {(n_3)}} _z\\end{matrix}\\right]}  {\\left[\\begin{matrix}  { {(n_1)}} ^x &amp;  { {(n_2)}} ^x &amp;  { {(n_3)}} ^x \\\\  { {(n_1)}} ^y &amp;  { {(n_2)}} ^y &amp;  { {(n_3)}} ^y \\\\  { {(n_1)}} ^z &amp;  { {(n_2)}} ^z &amp;  { {(n_3)}} ^z\\end{matrix}\\right]}}} = {\\left[\\begin{matrix}  {{{{ {(n_1)}} _x}} {{{ {(n_1)}} ^x}}} + {{{{ {(n_1)}} _y}} {{{ {(n_1)}} ^y}}} + {{{{ {(n_1)}} _z}} {{{ {(n_1)}} ^z}}} &amp;  {{{{ {(n_1)}} _x}} {{{ {(n_2)}} ^x}}} + {{{{ {(n_1)}} _y}} {{{ {(n_2)}} ^y}}} + {{{{ {(n_1)}} _z}} {{{ {(n_2)}} ^z}}} &amp;  {{{{ {(n_1)}} _x}} {{{ {(n_3)}} ^x}}} + {{{{ {(n_1)}} _y}} {{{ {(n_3)}} ^y}}} + {{{{ {(n_1)}} _z}} {{{ {(n_3)}} ^z}}} \\\\  {{{{ {(n_1)}} ^x}} {{{ {(n_2)}} _x}}} + {{{{ {(n_1)}} ^y}} {{{ {(n_2)}} _y}}} + {{{{ {(n_1)}} ^z}} {{{ {(n_2)}} _z}}} &amp;  {{{{ {(n_2)}} _x}} {{{ {(n_2)}} ^x}}} + {{{{ {(n_2)}} _y}} {{{ {(n_2)}} ^y}}} + {{{{ {(n_2)}} _z}} {{{ {(n_2)}} ^z}}} &amp;  {{{{ {(n_2)}} _x}} {{{ {(n_3)}} ^x}}} + {{{{ {(n_2)}} _y}} {{{ {(n_3)}} ^y}}} + {{{{ {(n_2)}} _z}} {{{ {(n_3)}} ^z}}} \\\\  {{{{ {(n_1)}} ^x}} {{{ {(n_3)}} _x}}} + {{{{ {(n_1)}} ^y}} {{{ {(n_3)}} _y}}} + {{{{ {(n_1)}} ^z}} {{{ {(n_3)}} _z}}} &amp;  {{{{ {(n_2)}} ^x}} {{{ {(n_3)}} _x}}} + {{{{ {(n_2)}} ^y}} {{{ {(n_3)}} _y}}} + {{{{ {(n_2)}} ^z}} {{{ {(n_3)}} _z}}} &amp;  {{{{ {(n_3)}} _x}} {{{ {(n_3)}} ^x}}} + {{{{ {(n_3)}} _y}} {{{ {(n_3)}} ^y}}} + {{{{ {(n_3)}} _z}} {{{ {(n_3)}} ^z}}}\\end{matrix}\\right]}} = {\\left[\\begin{matrix}  {{|n_1|}}^{2} &amp;  0 &amp;  0 \\\\  0 &amp;  {{|n_2|}}^{2} &amp;  0 \\\\  0 &amp;  0 &amp;  {{|n_3|}}^{2}\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=101},
	{hidden=false, input="print('In terms of identity:')\nprint((var'N^\\\\flat_{3x3}''^T' * (var'N^\\\\sharp_{3x3}' * var'N^\\\\parallel_{3x3}'^-1)):eq(\n\9Nl_3x3mat:T() * (\n\9\9Nu_3x3mat * Matrix.diagonal(1/n1Len^2, 1/n2Len^2, 1/n3Len^2)\n\9)()\n):eq(\n\9Matrix.identity(3)\n));", output="In terms of identity:<br>\n${{{{{ {N^\\flat_{3x3}}} ^T}} {{{N^\\sharp_{3x3}}}} \\cdot {{{{N^\\parallel_{3x3}}}^{-1}}}} = { {\\left[\\begin{matrix}  { {(n_1)}} _x &amp;  { {(n_1)}} _y &amp;  { {(n_1)}} _z \\\\  { {(n_2)}} _x &amp;  { {(n_2)}} _y &amp;  { {(n_2)}} _z \\\\  { {(n_3)}} _x &amp;  { {(n_3)}} _y &amp;  { {(n_3)}} _z\\end{matrix}\\right]}  {\\left[\\begin{matrix}  \\frac{{ {(n_1)}} ^x}{{{|n_1|}}^{2}} &amp;  \\frac{{ {(n_2)}} ^x}{{{|n_2|}}^{2}} &amp;  \\frac{{ {(n_3)}} ^x}{{{|n_3|}}^{2}} \\\\  \\frac{{ {(n_1)}} ^y}{{{|n_1|}}^{2}} &amp;  \\frac{{ {(n_2)}} ^y}{{{|n_2|}}^{2}} &amp;  \\frac{{ {(n_3)}} ^y}{{{|n_3|}}^{2}} \\\\  \\frac{{ {(n_1)}} ^z}{{{|n_1|}}^{2}} &amp;  \\frac{{ {(n_2)}} ^z}{{{|n_2|}}^{2}} &amp;  \\frac{{ {(n_3)}} ^z}{{{|n_3|}}^{2}}\\end{matrix}\\right]}}} = {\\left[\\begin{matrix}  1 &amp;  0 &amp;  0 \\\\  0 &amp;  1 &amp;  0 \\\\  0 &amp;  0 &amp;  1\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=102},
	{hidden=false, input="print'Now if $A A^{-1} = I$ then $A^{-1} A = I$:'", output="Now if $A A^{-1} = I$ then $A^{-1} A = I$:<br>\n", outputtype="html", uid=103},
	{hidden=false, input="print((\n\9(var'N^\\\\sharp_{3x3}' * var'N^\\\\parallel_{3x3}'^-1) * var'N^\\\\flat_{3x3}''^T'\n):eq(\n\9(Nu_3x3mat * Matrix.diagonal(1/n1Len^2, 1/n2Len^2, 1/n3Len^2))() * Nl_3x3mat:T()\n):eq(\n\9(\n\9\9Nu_3x3mat * Matrix.diagonal(1/n1Len^2, 1/n2Len^2, 1/n3Len^2) * Nl_3x3mat:T()\n\9):simplifyAddMulDiv()\n):eq(\n\9Matrix.identity(3)\n))", output="${{{{{{N^\\sharp_{3x3}}}} \\cdot {{{{N^\\parallel_{3x3}}}^{-1}}} {{{ {N^\\flat_{3x3}}} ^T}}} = { {\\left[\\begin{matrix}  \\frac{{ {(n_1)}} ^x}{{{|n_1|}}^{2}} &amp;  \\frac{{ {(n_2)}} ^x}{{{|n_2|}}^{2}} &amp;  \\frac{{ {(n_3)}} ^x}{{{|n_3|}}^{2}} \\\\  \\frac{{ {(n_1)}} ^y}{{{|n_1|}}^{2}} &amp;  \\frac{{ {(n_2)}} ^y}{{{|n_2|}}^{2}} &amp;  \\frac{{ {(n_3)}} ^y}{{{|n_3|}}^{2}} \\\\  \\frac{{ {(n_1)}} ^z}{{{|n_1|}}^{2}} &amp;  \\frac{{ {(n_2)}} ^z}{{{|n_2|}}^{2}} &amp;  \\frac{{ {(n_3)}} ^z}{{{|n_3|}}^{2}}\\end{matrix}\\right]}  {\\left[\\begin{matrix}  { {(n_1)}} _x &amp;  { {(n_1)}} _y &amp;  { {(n_1)}} _z \\\\  { {(n_2)}} _x &amp;  { {(n_2)}} _y &amp;  { {(n_2)}} _z \\\\  { {(n_3)}} _x &amp;  { {(n_3)}} _y &amp;  { {(n_3)}} _z\\end{matrix}\\right]}}} = {\\left[\\begin{matrix}  {{{{ {(n_1)}} _x}} {{{ {(n_1)}} ^x}} {{\\frac{1}{{{|n_1|}}^{2}}}}} + {{{{ {(n_2)}} _x}} {{{ {(n_2)}} ^x}} {{\\frac{1}{{{|n_2|}}^{2}}}}} + {{{{ {(n_3)}} _x}} {{{ {(n_3)}} ^x}} {{\\frac{1}{{{|n_3|}}^{2}}}}} &amp;  {{{{ {(n_1)}} ^x}} {{{ {(n_1)}} _y}} {{\\frac{1}{{{|n_1|}}^{2}}}}} + {{{{ {(n_2)}} ^x}} {{{ {(n_2)}} _y}} {{\\frac{1}{{{|n_2|}}^{2}}}}} + {{{{ {(n_3)}} ^x}} {{{ {(n_3)}} _y}} {{\\frac{1}{{{|n_3|}}^{2}}}}} &amp;  {{{{ {(n_1)}} ^x}} {{{ {(n_1)}} _z}} {{\\frac{1}{{{|n_1|}}^{2}}}}} + {{{{ {(n_2)}} ^x}} {{{ {(n_2)}} _z}} {{\\frac{1}{{{|n_2|}}^{2}}}}} + {{{{ {(n_3)}} ^x}} {{{ {(n_3)}} _z}} {{\\frac{1}{{{|n_3|}}^{2}}}}} \\\\  {{{{ {(n_1)}} _x}} {{{ {(n_1)}} ^y}} {{\\frac{1}{{{|n_1|}}^{2}}}}} + {{{{ {(n_2)}} _x}} {{{ {(n_2)}} ^y}} {{\\frac{1}{{{|n_2|}}^{2}}}}} + {{{{ {(n_3)}} _x}} {{{ {(n_3)}} ^y}} {{\\frac{1}{{{|n_3|}}^{2}}}}} &amp;  {{{{ {(n_1)}} _y}} {{{ {(n_1)}} ^y}} {{\\frac{1}{{{|n_1|}}^{2}}}}} + {{{{ {(n_2)}} _y}} {{{ {(n_2)}} ^y}} {{\\frac{1}{{{|n_2|}}^{2}}}}} + {{{{ {(n_3)}} _y}} {{{ {(n_3)}} ^y}} {{\\frac{1}{{{|n_3|}}^{2}}}}} &amp;  {{{{ {(n_1)}} ^y}} {{{ {(n_1)}} _z}} {{\\frac{1}{{{|n_1|}}^{2}}}}} + {{{{ {(n_2)}} ^y}} {{{ {(n_2)}} _z}} {{\\frac{1}{{{|n_2|}}^{2}}}}} + {{{{ {(n_3)}} ^y}} {{{ {(n_3)}} _z}} {{\\frac{1}{{{|n_3|}}^{2}}}}} \\\\  {{{{ {(n_1)}} _x}} {{{ {(n_1)}} ^z}} {{\\frac{1}{{{|n_1|}}^{2}}}}} + {{{{ {(n_2)}} _x}} {{{ {(n_2)}} ^z}} {{\\frac{1}{{{|n_2|}}^{2}}}}} + {{{{ {(n_3)}} _x}} {{{ {(n_3)}} ^z}} {{\\frac{1}{{{|n_3|}}^{2}}}}} &amp;  {{{{ {(n_1)}} _y}} {{{ {(n_1)}} ^z}} {{\\frac{1}{{{|n_1|}}^{2}}}}} + {{{{ {(n_2)}} _y}} {{{ {(n_2)}} ^z}} {{\\frac{1}{{{|n_2|}}^{2}}}}} + {{{{ {(n_3)}} _y}} {{{ {(n_3)}} ^z}} {{\\frac{1}{{{|n_3|}}^{2}}}}} &amp;  {{{{ {(n_1)}} _z}} {{{ {(n_1)}} ^z}} {{\\frac{1}{{{|n_1|}}^{2}}}}} + {{{{ {(n_2)}} _z}} {{{ {(n_2)}} ^z}} {{\\frac{1}{{{|n_2|}}^{2}}}}} + {{{{ {(n_3)}} _z}} {{{ {(n_3)}} ^z}} {{\\frac{1}{{{|n_3|}}^{2}}}}}\\end{matrix}\\right]}} = {\\left[\\begin{matrix}  1 &amp;  0 &amp;  0 \\\\  0 &amp;  1 &amp;  0 \\\\  0 &amp;  0 &amp;  1\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=104},
	{hidden=false, input="-- TODO how to automate this, especially with expandMatrix4to8 ... but I need a thing for replacing n_ij with ni_dense[j]", output="", outputtype="html", uid=107},
	{hidden=false, input="Nl = Matrix(\n\9{1, 0, 0, 0, 0, 0, 0, 0},\n\9{0, nl_dense[1], nl_dense[2], nl_dense[3], 0, 0, 0, 0},\n\9{0, n2l_dense[1], n2l_dense[2], n2l_dense[3], 0, 0, 0, 0},\n\9{0, n3l_dense[1], n3l_dense[2], n3l_dense[3], 0, 0, 0, 0},\n\9{0, 0, 0, 0, nl_dense[1], nl_dense[2], nl_dense[3], 0},\n\9{0, 0, 0, 0, n2l_dense[1], n2l_dense[2], n2l_dense[3], 0},\n\9{0, 0, 0, 0, n3l_dense[1], n3l_dense[2], n3l_dense[3], 0},\n\9{0, 0, 0, 0, 0, 0, 0, 1}\n):T()", output="$\\left[\\begin{matrix}  1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  { {(n_1)}} _x &amp;  { {(n_2)}} _x &amp;  { {(n_3)}} _x &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  { {(n_1)}} _y &amp;  { {(n_2)}} _y &amp;  { {(n_3)}} _y &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  { {(n_1)}} _z &amp;  { {(n_2)}} _z &amp;  { {(n_3)}} _z &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  { {(n_1)}} _x &amp;  { {(n_2)}} _x &amp;  { {(n_3)}} _x &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  { {(n_1)}} _y &amp;  { {(n_2)}} _y &amp;  { {(n_3)}} _y &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  { {(n_1)}} _z &amp;  { {(n_2)}} _z &amp;  { {(n_3)}} _z &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  1\\end{matrix}\\right]$", outputtype="html", uid=105},
	{hidden=false, input="Nu = Matrix(\n\9{1, 0, 0, 0, 0, 0, 0, 0},\n\9{0, nu_dense[1], nu_dense[2], nu_dense[3], 0, 0, 0, 0},\n\9{0, n2u_dense[1], n2u_dense[2], n2u_dense[3], 0, 0, 0, 0},\n\9{0, n3u_dense[1], n3u_dense[2], n3u_dense[3], 0, 0, 0, 0},\n\9{0, 0, 0, 0, nu_dense[1], nu_dense[2], nu_dense[3], 0},\n\9{0, 0, 0, 0, n2u_dense[1], n2u_dense[2], n2u_dense[3], 0},\n\9{0, 0, 0, 0, n3u_dense[1], n3u_dense[2], n3u_dense[3], 0},\n\9{0, 0, 0, 0, 0, 0, 0, 1}\n):T()", output="$\\left[\\begin{matrix}  1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  { {(n_1)}} ^x &amp;  { {(n_2)}} ^x &amp;  { {(n_3)}} ^x &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  { {(n_1)}} ^y &amp;  { {(n_2)}} ^y &amp;  { {(n_3)}} ^y &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  { {(n_1)}} ^z &amp;  { {(n_2)}} ^z &amp;  { {(n_3)}} ^z &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  { {(n_1)}} ^x &amp;  { {(n_2)}} ^x &amp;  { {(n_3)}} ^x &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  { {(n_1)}} ^y &amp;  { {(n_2)}} ^y &amp;  { {(n_3)}} ^y &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  { {(n_1)}} ^z &amp;  { {(n_2)}} ^z &amp;  { {(n_3)}} ^z &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  1\\end{matrix}\\right]$", outputtype="html", uid=106},
	{hidden=false, input="print'Realigned, using the normal basis, which is inverses of one another, so that I can just apply it to the left and right eigenvector transforms.'", output="Realigned, using the normal basis, which is inverses of one another, so that I can just apply it to the left and right eigenvector transforms.<br>\n", outputtype="html", uid=108},
	{hidden=false, input="A8_expanded_with_Ns = (\n\9\9Nu * Matrix.diagonal(\n\9\9\0091,\n\9\9\0091/n1Len^2, 1/n2Len^2, 1/n3Len^2,\n\9\9\0091/n1Len^2, 1/n2Len^2, 1/n3Len^2,\n\9\9\0091\n\9\9)\n\9)() \n\9* (\n\9\9Matrix.diagonal(\n\9\9\0091,\n\9\9\9n1Len^2, n2Len^2, n3Len^2,\n\9\9\9n1Len^2, n2Len^2, n3Len^2,\n\9\9\0091\n\9\9) * A8_expanded\n\9)() \n\9* Nl:T()\nA8_expanded = A8_expanded_with_Ns()\nprint(A'^I_J':eq(A8_expanded_with_Ns):eq(A_expanded))\n-- if this reproduces the original then just factor out Nl and Nu from both sides and do the eigen-decomposition of the x-axis version\n-- since it is easier to do\n;", output="${{{{ A} ^I} _J} = { {\\left[\\begin{matrix}  1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  \\frac{{ {(n_1)}} ^x}{{{|n_1|}}^{2}} &amp;  \\frac{{ {(n_2)}} ^x}{{{|n_2|}}^{2}} &amp;  \\frac{{ {(n_3)}} ^x}{{{|n_3|}}^{2}} &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  \\frac{{ {(n_1)}} ^y}{{{|n_1|}}^{2}} &amp;  \\frac{{ {(n_2)}} ^y}{{{|n_2|}}^{2}} &amp;  \\frac{{ {(n_3)}} ^y}{{{|n_3|}}^{2}} &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  \\frac{{ {(n_1)}} ^z}{{{|n_1|}}^{2}} &amp;  \\frac{{ {(n_2)}} ^z}{{{|n_2|}}^{2}} &amp;  \\frac{{ {(n_3)}} ^z}{{{|n_3|}}^{2}} &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  \\frac{{ {(n_1)}} ^x}{{{|n_1|}}^{2}} &amp;  \\frac{{ {(n_2)}} ^x}{{{|n_2|}}^{2}} &amp;  \\frac{{ {(n_3)}} ^x}{{{|n_3|}}^{2}} &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  \\frac{{ {(n_1)}} ^y}{{{|n_1|}}^{2}} &amp;  \\frac{{ {(n_2)}} ^y}{{{|n_2|}}^{2}} &amp;  \\frac{{ {(n_3)}} ^y}{{{|n_3|}}^{2}} &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  \\frac{{ {(n_1)}} ^z}{{{|n_1|}}^{2}} &amp;  \\frac{{ {(n_2)}} ^z}{{{|n_2|}}^{2}} &amp;  \\frac{{ {(n_3)}} ^z}{{{|n_3|}}^{2}} &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  1\\end{matrix}\\right]}  {\\left[\\begin{matrix}  0 &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _x}} &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _y}} &amp;  {{\\rho}} \\cdot {{{ {(n_1)}} _z}} &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  \\frac{{{{{|n_1|}}^{2}}} {{\\left({{{{{ {(n_1)}} ^x}} {{{ B} _x}}}{-{{{{ {(n_1)}} _a}} {{{ B} ^a}}}}{-{{{{ {(n_1)}} _x}} {{{ B} ^x}}}}}\\right)}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{{{{{|n_1|}}^{2}}} {{\\left({{{{{ {(n_1)}} ^x}} {{{ B} _y}}}{-{{{{ {(n_1)}} _y}} {{{ B} ^x}}}}}\\right)}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{{{{{|n_1|}}^{2}}} {{\\left({{{{{ {(n_1)}} ^x}} {{{ B} _z}}}{-{{{{ {(n_1)}} _z}} {{{ B} ^x}}}}}\\right)}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  {\\frac{1}{\\rho}} {{{{ {(n_1)}} ^x}} {{{{|n_1|}}^{2}}}} \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  \\frac{{{{{|n_2|}}^{2}}} {{\\left({{{{{ {(n_1)}} ^y}} {{{ B} _x}}}{-{{{{ {(n_1)}} _x}} {{{ B} ^y}}}}}\\right)}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{{{{{|n_2|}}^{2}}} {{\\left({{{{{ {(n_1)}} ^y}} {{{ B} _y}}}{-{{{{ {(n_1)}} _a}} {{{ B} ^a}}}}{-{{{{ {(n_1)}} _y}} {{{ B} ^y}}}}}\\right)}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{{{{{|n_2|}}^{2}}} {{\\left({{{{{ {(n_1)}} ^y}} {{{ B} _z}}}{-{{{{ {(n_1)}} _z}} {{{ B} ^y}}}}}\\right)}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  {\\frac{1}{\\rho}} {{{{ {(n_1)}} ^y}} {{{{|n_2|}}^{2}}}} \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  \\frac{{{{{|n_3|}}^{2}}} {{\\left({{{{{ {(n_1)}} ^z}} {{{ B} _x}}}{-{{{{ {(n_1)}} _x}} {{{ B} ^z}}}}}\\right)}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{{{{{|n_3|}}^{2}}} {{\\left({{{{{ {(n_1)}} ^z}} {{{ B} _y}}}{-{{{{ {(n_1)}} _y}} {{{ B} ^z}}}}}\\right)}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{{{{{|n_3|}}^{2}}} {{\\left({{{{{ {(n_1)}} ^z}} {{{ B} _z}}}{-{{{{ {(n_1)}} _a}} {{{ B} ^a}}}}{-{{{{ {(n_1)}} _z}} {{{ B} ^z}}}}}\\right)}}}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  {\\frac{1}{\\rho}} {{{{ {(n_1)}} ^z}} {{{{|n_3|}}^{2}}}} \\\\  0 &amp;  {{{{|n_1|}}^{2}}} {{\\left({{-{{{{ {(n_1)}} _a}} {{{ B} ^a}}}} + {{{{ {(n_1)}} _x}} {{{ B} ^x}}}}\\right)}} &amp;  {{{ {(n_1)}} _y}} {{{ B} ^x}} {{{{|n_1|}}^{2}}} &amp;  {{{ {(n_1)}} _z}} {{{ B} ^x}} {{{{|n_1|}}^{2}}} &amp;  -{{{{ {(n_1)}} _x}} {{{ v} ^x}} {{{{|n_1|}}^{2}}}} &amp;  -{{{{ {(n_1)}} _y}} {{{ v} ^x}} {{{{|n_1|}}^{2}}}} &amp;  -{{{{ {(n_1)}} _z}} {{{ v} ^x}} {{{{|n_1|}}^{2}}}} &amp;  0 \\\\  0 &amp;  {{{ {(n_1)}} _x}} {{{ B} ^y}} {{{{|n_2|}}^{2}}} &amp;  {{{{|n_2|}}^{2}}} {{\\left({{-{{{{ {(n_1)}} _a}} {{{ B} ^a}}}} + {{{{ {(n_1)}} _y}} {{{ B} ^y}}}}\\right)}} &amp;  {{{ {(n_1)}} _z}} {{{ B} ^y}} {{{{|n_2|}}^{2}}} &amp;  -{{{{ {(n_1)}} _x}} {{{ v} ^y}} {{{{|n_2|}}^{2}}}} &amp;  -{{{{ {(n_1)}} _y}} {{{ v} ^y}} {{{{|n_2|}}^{2}}}} &amp;  -{{{{ {(n_1)}} _z}} {{{ v} ^y}} {{{{|n_2|}}^{2}}}} &amp;  0 \\\\  0 &amp;  {{{ {(n_1)}} _x}} {{{ B} ^z}} {{{{|n_3|}}^{2}}} &amp;  {{{ {(n_1)}} _y}} {{{ B} ^z}} {{{{|n_3|}}^{2}}} &amp;  {{{{|n_3|}}^{2}}} {{\\left({{-{{{{ {(n_1)}} _a}} {{{ B} ^a}}}} + {{{{ {(n_1)}} _z}} {{{ B} ^z}}}}\\right)}} &amp;  -{{{{ {(n_1)}} _x}} {{{ v} ^z}} {{{{|n_3|}}^{2}}}} &amp;  -{{{{ {(n_1)}} _y}} {{{ v} ^z}} {{{{|n_3|}}^{2}}}} &amp;  -{{{{ {(n_1)}} _z}} {{{ v} ^z}} {{{{|n_3|}}^{2}}}} &amp;  0 \\\\  0 &amp;  {{P}} {{\\gamma}} \\cdot {{{ {(n_1)}} _x}} &amp;  {{P}} {{\\gamma}} \\cdot {{{ {(n_1)}} _y}} &amp;  {{P}} {{\\gamma}} \\cdot {{{ {(n_1)}} _z}} &amp;  {\\frac{1}{{\\mu_0}}} {{{{ {(n_1)}} _x}} {{{ B} _a}} {{{ v} ^a}} {{\\left({{-{1}} + {\\gamma}}\\right)}}} &amp;  {\\frac{1}{{\\mu_0}}} {{{{ {(n_1)}} _y}} {{{ B} _a}} {{{ v} ^a}} {{\\left({{-{1}} + {\\gamma}}\\right)}}} &amp;  {\\frac{1}{{\\mu_0}}} {{{{ {(n_1)}} _z}} {{{ B} _a}} {{{ v} ^a}} {{\\left({{-{1}} + {\\gamma}}\\right)}}} &amp;  0\\end{matrix}\\right]}  {\\left[\\begin{matrix}  1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  { {(n_1)}} _x &amp;  { {(n_1)}} _y &amp;  { {(n_1)}} _z &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  { {(n_2)}} _x &amp;  { {(n_2)}} _y &amp;  { {(n_2)}} _z &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  { {(n_3)}} _x &amp;  { {(n_3)}} _y &amp;  { {(n_3)}} _z &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  { {(n_1)}} _x &amp;  { {(n_1)}} _y &amp;  { {(n_1)}} _z &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  { {(n_2)}} _x &amp;  { {(n_2)}} _y &amp;  { {(n_2)}} _z &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  { {(n_3)}} _x &amp;  { {(n_3)}} _y &amp;  { {(n_3)}} _z &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  1\\end{matrix}\\right]}}} = {\\left[\\begin{matrix}  0 &amp;  \\rho &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  \\frac{{ B} ^y}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{{ B} ^z}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{1}{\\rho} \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  -{\\frac{{ B} ^x}{{{{\\mu_0}}} \\cdot {{\\rho}}}} &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  -{\\frac{{ B} ^x}{{{{\\mu_0}}} \\cdot {{\\rho}}}} &amp;  0 \\\\  0 &amp;  { B} ^y &amp;  -{{ B} ^x} &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  { B} ^z &amp;  0 &amp;  -{{ B} ^x} &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  {{\\rho}} \\cdot {{{{c_s}}^{2}}} &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0\\end{matrix}\\right]}$<br>\n", outputtype="html", uid=109},
	{hidden=false, input="-- TODO if you want, (a) consider when n_1 = 0 or n_2 = 0\n-- and/or (b) just replace all the e_x, e_y cross n with a basis {n, n2, n3}\n-- (just like the MathWorksheets \"Euler Fluid Equations - Curved Geometry - Contravariant\" worksheet already does).\n\nA'^I_J':eq(var'(R_A)''^I_M' * var'(\\\\Lambda_A)''^M_N' * var'(L_A)''^N_J')", output="${{{ A} ^I} _J} = {{{{{ {(R_A)}} ^I} _M}} {{{{ {(\\Lambda_A)}} ^M} _N}} {{{{ {(L_A)}} ^N} _J}}}$", outputtype="html", uid=110},
	{hidden=false, input="-- TODO I was making some approximations on contravariant vs covariant that I didn't have to for Euler fluid equations ... \n-- are they good for wrt eigen decomposition?", output="", outputtype="html", uid=112},
	{hidden=false, input="A_expanded", output="$\\left[\\begin{matrix}  0 &amp;  \\rho &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  \\frac{{ B} ^y}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{{ B} ^z}{{{{\\mu_0}}} \\cdot {{\\rho}}} &amp;  \\frac{1}{\\rho} \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  -{\\frac{{ B} ^x}{{{{\\mu_0}}} \\cdot {{\\rho}}}} &amp;  0 &amp;  0 \\\\  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  -{\\frac{{ B} ^x}{{{{\\mu_0}}} \\cdot {{\\rho}}}} &amp;  0 \\\\  0 &amp;  { B} ^y &amp;  -{{ B} ^x} &amp;  0 &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  { B} ^z &amp;  0 &amp;  -{{ B} ^x} &amp;  0 &amp;  0 &amp;  0 \\\\  0 &amp;  {{\\rho}} \\cdot {{{{c_s}}^{2}}} &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0\\end{matrix}\\right]$", outputtype="html", uid=119},
	{hidden=false, input="lambda = var'\\\\lambda';", output="", outputtype="html", uid=128},
	{hidden=false, input="-- this will fail to factor, cuz its a 7-degree poly...\n--eig = A_expanded():eigen{lambdaVar=lambda}\n--print(table.keys(eig):sort():concat', ')\n--print(eig.defective)\n--print(eig.charPoly)", output="", outputtype="html", uid=111},
	{hidden=false, input="-- so instead we can assert the char poly matches\n-- and then feed those lambdas into the eigensystem to get our nullspaces/eigenvectors...\neigCharPoly = A_expanded():charpoly(lambda)", output="${-{\\frac{{{\\lambda}} \\cdot {{\\left({{{{{\\lambda}^{2}}} {{\\left({{{{{{ B} ^x}^{2}}} {{\\left({{{{ B} ^y}^{2}}{-{{{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{\\left({{\\lambda} + {{c_s}}}\\right)}} {{\\left({{\\lambda}{-{{c_s}}}}\\right)}}}}}\\right)}}}{-{{{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{\\left({{{{{\\lambda}^{2}}} {{{{ B} ^y}^{2}}}} + {{{{\\lambda}^{2}}} {{\\left({{{{ B} ^z}^{2}}{-{{{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{\\left({{\\lambda} + {{c_s}}}\\right)}} {{\\left({{\\lambda}{-{{c_s}}}}\\right)}}}}}\\right)}}}}\\right)}}}}}\\right)}}} + {{{{{ B} ^x}^{2}}} {{\\left({{{{{\\lambda}^{2}}} {{\\left({{{{ B} ^z}^{2}}{-{{{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{\\left({{\\lambda} + {{c_s}}}\\right)}} {{\\left({{\\lambda}{-{{c_s}}}}\\right)}}}}}\\right)}}} + {{{{{ B} ^x}^{2}}} {{\\left({{\\lambda}{-{{c_s}}}}\\right)}} {{\\left({{\\lambda} + {{c_s}}}\\right)}}}}\\right)}}}}\\right)}}}{{{{{\\mu_0}}^{2}}} {{{\\rho}^{2}}}}}} = {0}$", outputtype="html", uid=127},
	{hidden=false, input="BSq_approx_def = BSq_var:eq(B'^x'^2 + B'^y'^2 + B'^z'^2) -- TODO op.approx ? that works for subst, but shows approx-eq sign?", output="${{(B)^2}} = {{{{ B} ^x}^{2}} + {{{ B} ^y}^{2}} + {{{ B} ^z}^{2}}}$", outputtype="html", uid=130},
	{hidden=false, input="-- from Samtaney 2007 notes' listed roots, reconstructing and comparing\nCt = var'c_t'\nCs_sq_def = (Cs_def^2)()\nCt_sq_def = (Ct^2):eq(Cs^2 + BSq_var / (mu_0 * rho))\nlambda_a = var'\\\\lambda_a' -- Alfven wave... typically ca in lit, where c's are wavespeeds, wave\nlambda_f = var'\\\\lambda_f' -- fast wave (but I used c_s for speed-of-sound and thre's a _s for slow )\nlambda_s = var'\\\\lambda_s'\nlambda_a_sq_def = (lambda_a^2):eq((B'^x')^2 / (mu_0 * rho))\nlambda_s_sq_def = (lambda_s^2):eq(frac(1,2) * (Ct^2 - sqrt(Ct^4 - 4 * Cs^2 * lambda_a^2)))\nlambda_f_sq_def = (lambda_f^2):eq(frac(1,2) * (Ct^2 + sqrt(Ct^4 - 4 * Cs^2 * lambda_a^2)))\nprint(Cs_sq_def) \nprint(Ct_sq_def)\nprint(lambda_a_sq_def)\nprint(lambda_s_sq_def)\nprint(lambda_f_sq_def)\n;", output="${{{c_s}}^{2}} = {{\\frac{1}{\\rho}} {{{P}} {{\\gamma}}}}$<br>\n${{{c_t}}^{2}} = {{{{c_s}}^{2}} + {\\frac{{(B)^2}}{{{{\\mu_0}}} \\cdot {{\\rho}}}}}$<br>\n${{{\\lambda_a}}^{2}} = {\\frac{{{ B} ^x}^{2}}{{{{\\mu_0}}} \\cdot {{\\rho}}}}$<br>\n${{{\\lambda_s}}^{2}} = {{{\\frac{1}{2}}} {{\\left({{{{c_t}}^{2}}{-{\\sqrt{{{{c_t}}^{4}}{-{{{4}} {{{{c_s}}^{2}}} {{{{\\lambda_a}}^{2}}}}}}}}}\\right)}}}$<br>\n${{{\\lambda_f}}^{2}} = {{{\\frac{1}{2}}} {{\\left({{{{c_t}}^{2}} + {\\sqrt{{{{c_t}}^{4}}{-{{{4}} {{{{c_s}}^{2}}} {{{{\\lambda_a}}^{2}}}}}}}}\\right)}}}$<br>\n", outputtype="html", uid=131},
	{hidden=false, input="-- verify that it matches the matrix char poly...\nlocal charpoly = ( -lambda*(lambda^2 - lambda_a^2)*(lambda^2 - lambda_s^2)*(lambda^2 - lambda_f^2) ):eq(0)\nprint(charpoly)\ncharpoly = charpoly:subst(lambda_s_sq_def, lambda_f_sq_def)\nprint(charpoly)\n\n--charpoly = charpoly:simplifyAddMulDiv()\ncharpoly = (\n\9-lambda*(lambda^2 - lambda_a^2) * (\n\9\9(lambda^2 - lambda_s^2)*(lambda^2 - lambda_f^2)\n\9):subst(lambda_s_sq_def, lambda_f_sq_def):simplifyAddMulDiv()\n):eq(0)\nprint(charpoly)\n\ncharpoly = charpoly:subst(lambda_a_sq_def, Ct_sq_def, (Ct_sq_def^2)(), BSq_approx_def)\nprint(charpoly)\n\ncharpoly = charpoly:simplifyAddMulDiv()\nprint(charpoly)\n\nprint('eigCharPoly', eigCharPoly:simplifyAddMulDiv())\nlocal diff = (charpoly - eigCharPoly):simplifyAddMulDiv()\nprint('diff', diff)\n;", output="${ {-{\\lambda}} {{\\left({{{\\lambda}^{2}}{-{{{\\lambda_a}}^{2}}}}\\right)}} {{\\left({{{\\lambda}^{2}}{-{{{\\lambda_s}}^{2}}}}\\right)}} {{\\left({{{\\lambda}^{2}}{-{{{\\lambda_f}}^{2}}}}\\right)}}} = {0}$<br>\n${ {-{\\lambda}} {{\\left({{{\\lambda}^{2}}{-{{{\\lambda_a}}^{2}}}}\\right)}} {{\\left({{{\\lambda}^{2}}{-{{{\\frac{1}{2}}} {{\\left({{{{c_t}}^{2}}{-{\\sqrt{{{{c_t}}^{4}}{-{{{4}} {{{{c_s}}^{2}}} {{{{\\lambda_a}}^{2}}}}}}}}}\\right)}}}}}\\right)}} {{\\left({{{\\lambda}^{2}}{-{{{\\frac{1}{2}}} {{\\left({{{{c_t}}^{2}} + {\\sqrt{{{{c_t}}^{4}}{-{{{4}} {{{{c_s}}^{2}}} {{{{\\lambda_a}}^{2}}}}}}}}\\right)}}}}}\\right)}}} = {0}$<br>\n${ {-{\\lambda}} {{\\left({{{\\lambda}^{2}}{-{{{\\lambda_a}}^{2}}}}\\right)}} {{\\left({{{{-1}} {{{\\lambda}^{2}}} {{{{c_t}}^{2}}}} + {{{{{\\lambda_a}}^{2}}} {{{{c_s}}^{2}}}} + {{\\lambda}^{4}}}\\right)}}} = {0}$<br>\n${ {-{\\lambda}} {{\\left({{{\\lambda}^{2}}{-{\\frac{{{ B} ^x}^{2}}{{{{\\mu_0}}} \\cdot {{\\rho}}}}}}\\right)}} {{\\left({{{{-1}} {{{\\lambda}^{2}}} {{\\left({{{{c_s}}^{2}} + {\\frac{{{{ B} ^x}^{2}} + {{{ B} ^y}^{2}} + {{{ B} ^z}^{2}}}{{{{\\mu_0}}} \\cdot {{\\rho}}}}}\\right)}}} + {{{{{c_s}}^{2}}} {{\\frac{{{ B} ^x}^{2}}{{{{\\mu_0}}} \\cdot {{\\rho}}}}}} + {{\\lambda}^{4}}}\\right)}}} = {0}$<br>\n${{{{-1}} {{{\\lambda}^{3}}} {{{{ B} ^x}^{4}}} {{\\frac{1}{{{\\mu_0}}^{2}}}} {{\\frac{1}{{\\rho}^{2}}}}} + {{{\\lambda}} \\cdot {{{{c_s}}^{2}}} {{{{ B} ^x}^{4}}} {{\\frac{1}{{{\\mu_0}}^{2}}}} {{\\frac{1}{{\\rho}^{2}}}}} + {{{-1}} {{{\\lambda}^{3}}} {{{{ B} ^x}^{2}}} {{{{ B} ^y}^{2}}} {{\\frac{1}{{{\\mu_0}}^{2}}}} {{\\frac{1}{{\\rho}^{2}}}}} + {{{-1}} {{{\\lambda}^{3}}} {{{{ B} ^x}^{2}}} {{{{ B} ^z}^{2}}} {{\\frac{1}{{{\\mu_0}}^{2}}}} {{\\frac{1}{{\\rho}^{2}}}}} + {{{-1}} {{{\\lambda}^{7}}}} + {{{{\\lambda}^{5}}} {{{{c_s}}^{2}}}} + {{{{\\lambda}^{5}}} {{{{ B} ^y}^{2}}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {{{{\\lambda}^{5}}} {{{{ B} ^z}^{2}}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {{{2}} {{{\\lambda}^{5}}} {{{{ B} ^x}^{2}}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {{{-2}} {{{\\lambda}^{3}}} {{{{c_s}}^{2}}} {{{{ B} ^x}^{2}}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}}} = {0}$<br>\neigCharPoly\9${{{{-1}} {{{\\lambda}^{3}}} {{{{ B} ^x}^{4}}} {{\\frac{1}{{{\\mu_0}}^{2}}}} {{\\frac{1}{{\\rho}^{2}}}}} + {{{\\lambda}} \\cdot {{{{c_s}}^{2}}} {{{{ B} ^x}^{4}}} {{\\frac{1}{{{\\mu_0}}^{2}}}} {{\\frac{1}{{\\rho}^{2}}}}} + {{{-1}} {{{\\lambda}^{3}}} {{{{ B} ^x}^{2}}} {{{{ B} ^y}^{2}}} {{\\frac{1}{{{\\mu_0}}^{2}}}} {{\\frac{1}{{\\rho}^{2}}}}} + {{{-1}} {{{\\lambda}^{3}}} {{{{ B} ^x}^{2}}} {{{{ B} ^z}^{2}}} {{\\frac{1}{{{\\mu_0}}^{2}}}} {{\\frac{1}{{\\rho}^{2}}}}} + {{{-1}} {{{\\lambda}^{7}}}} + {{{{\\lambda}^{5}}} {{{{c_s}}^{2}}}} + {{{{\\lambda}^{5}}} {{{{ B} ^y}^{2}}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {{{{\\lambda}^{5}}} {{{{ B} ^z}^{2}}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {{{2}} {{{\\lambda}^{5}}} {{{{ B} ^x}^{2}}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {{{-2}} {{{\\lambda}^{3}}} {{{{c_s}}^{2}}} {{{{ B} ^x}^{2}}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}}} = {0}$<br>\ndiff\9${0} = {0}$<br>\n", outputtype="html", uid=129},
	{hidden=false, input="eigLambdas = table{\n\9Constant(0),\n\9 sqrt(lambda_a_sq_def:rhs())(),\n\9-sqrt(lambda_a_sq_def:rhs()):subst(lambda_a_sq_def, Ct_sq_def, (Ct_sq_def^2)(), BSq_approx_def)(),\n\9 sqrt(lambda_s_sq_def:rhs()):subst(lambda_a_sq_def, Ct_sq_def, (Ct_sq_def^2)(), BSq_approx_def)(),\n\9-sqrt(lambda_s_sq_def:rhs()):subst(lambda_a_sq_def, Ct_sq_def, (Ct_sq_def^2)(), BSq_approx_def)(),\n\9 sqrt(lambda_f_sq_def:rhs()):subst(lambda_a_sq_def, Ct_sq_def, (Ct_sq_def^2)(), BSq_approx_def)(),\n\9-sqrt(lambda_f_sq_def:rhs()):subst(lambda_a_sq_def, Ct_sq_def, (Ct_sq_def^2)(), BSq_approx_def)(),\n}\nprint('{', eigLambdas:mapi(tostring):concat', ', '}');", output="{\9$0$, ${{{ B} ^x}} {{\\frac{1}{\\sqrt{{\\mu_0}}}}} {{\\frac{1}{\\sqrt{\\rho}}}}$, $-{{{{ B} ^x}} {{\\frac{1}{\\sqrt{{\\mu_0}}}}} {{\\frac{1}{\\sqrt{\\rho}}}}}$, ${{\\frac{1}{\\sqrt{2}}}} {{\\frac{1}{\\sqrt{{\\mu_0}}}}} {{\\frac{1}{\\sqrt{\\rho}}}} {{\\sqrt{{{{ B} ^x}^{2}} + {{{ B} ^y}^{2}} + {{{ B} ^z}^{2}} + {{{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{{c_s}}^{2}}}}{-{\\sqrt{{{{ B} ^x}^{4}} + {{{ B} ^y}^{4}} + {{{ B} ^z}^{4}} + {{{2}} {{{{ B} ^x}^{2}}} {{{{ B} ^y}^{2}}}} + {{{2}} {{{{ B} ^x}^{2}}} {{{{ B} ^z}^{2}}}} + {{{2}} {{{{ B} ^y}^{2}}} {{{{ B} ^z}^{2}}}} + {{{{{\\mu_0}}^{2}}} {{{\\rho}^{2}}} {{{{c_s}}^{4}}}}{-{{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{{c_s}}^{2}}} {{{{ B} ^x}^{2}}}}} + {{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{{c_s}}^{2}}} {{{{ B} ^y}^{2}}}} + {{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{{c_s}}^{2}}} {{{{ B} ^z}^{2}}}}}}}}}}$, $-{{{\\frac{1}{\\sqrt{2}}}} {{\\frac{1}{\\sqrt{{\\mu_0}}}}} {{\\frac{1}{\\sqrt{\\rho}}}} {{\\sqrt{{{{ B} ^x}^{2}} + {{{ B} ^y}^{2}} + {{{ B} ^z}^{2}} + {{{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{{c_s}}^{2}}}}{-{\\sqrt{{{{ B} ^x}^{4}} + {{{ B} ^y}^{4}} + {{{ B} ^z}^{4}} + {{{2}} {{{{ B} ^x}^{2}}} {{{{ B} ^y}^{2}}}} + {{{2}} {{{{ B} ^x}^{2}}} {{{{ B} ^z}^{2}}}} + {{{2}} {{{{ B} ^y}^{2}}} {{{{ B} ^z}^{2}}}} + {{{{{\\mu_0}}^{2}}} {{{\\rho}^{2}}} {{{{c_s}}^{4}}}}{-{{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{{c_s}}^{2}}} {{{{ B} ^x}^{2}}}}} + {{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{{c_s}}^{2}}} {{{{ B} ^y}^{2}}}} + {{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{{c_s}}^{2}}} {{{{ B} ^z}^{2}}}}}}}}}}}$, ${{\\frac{1}{\\sqrt{2}}}} {{\\frac{1}{\\sqrt{{\\mu_0}}}}} {{\\frac{1}{\\sqrt{\\rho}}}} {{\\sqrt{{{{ B} ^x}^{2}} + {{{ B} ^y}^{2}} + {{{ B} ^z}^{2}} + {\\sqrt{{{{ B} ^x}^{4}} + {{{ B} ^y}^{4}} + {{{ B} ^z}^{4}} + {{{2}} {{{{ B} ^x}^{2}}} {{{{ B} ^y}^{2}}}} + {{{2}} {{{{ B} ^x}^{2}}} {{{{ B} ^z}^{2}}}} + {{{2}} {{{{ B} ^y}^{2}}} {{{{ B} ^z}^{2}}}} + {{{{{\\mu_0}}^{2}}} {{{\\rho}^{2}}} {{{{c_s}}^{4}}}}{-{{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{{c_s}}^{2}}} {{{{ B} ^x}^{2}}}}} + {{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{{c_s}}^{2}}} {{{{ B} ^y}^{2}}}} + {{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{{c_s}}^{2}}} {{{{ B} ^z}^{2}}}}}} + {{{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{{c_s}}^{2}}}}}}}$, $-{{{\\frac{1}{\\sqrt{2}}}} {{\\frac{1}{\\sqrt{{\\mu_0}}}}} {{\\frac{1}{\\sqrt{\\rho}}}} {{\\sqrt{{{{ B} ^x}^{2}} + {{{ B} ^y}^{2}} + {{{ B} ^z}^{2}} + {\\sqrt{{{{ B} ^x}^{4}} + {{{ B} ^y}^{4}} + {{{ B} ^z}^{4}} + {{{2}} {{{{ B} ^x}^{2}}} {{{{ B} ^y}^{2}}}} + {{{2}} {{{{ B} ^x}^{2}}} {{{{ B} ^z}^{2}}}} + {{{2}} {{{{ B} ^y}^{2}}} {{{{ B} ^z}^{2}}}} + {{{{{\\mu_0}}^{2}}} {{{\\rho}^{2}}} {{{{c_s}}^{4}}}}{-{{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{{c_s}}^{2}}} {{{{ B} ^x}^{2}}}}} + {{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{{c_s}}^{2}}} {{{{ B} ^y}^{2}}}} + {{{2}} {{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{{c_s}}^{2}}} {{{{ B} ^z}^{2}}}}}} + {{{{\\mu_0}}} \\cdot {{\\rho}} \\cdot {{{{c_s}}^{2}}}}}}}}$\9}<br>\n", outputtype="html", uid=132},
	{hidden=false, input="(A_expanded - eigLambdas[1] * Matrix.identity(7))():nullspace()", output="$\\left[\\begin{matrix}  1 \\\\  0 \\\\  0 \\\\  0 \\\\  0 \\\\  0 \\\\  0\\end{matrix}\\right]$", outputtype="html", uid=143},
	{hidden=false, input="(A_expanded - eigLambdas[2] * Matrix.identity(7))():nullspace()", output="$\\left[\\begin{matrix}  0 \\\\  0 \\\\  \\frac{{{{ B} ^z}} {{\\frac{1}{\\sqrt{\\rho}}}}}{{{{ B} ^y}} {{\\sqrt{{\\mu_0}}}}} \\\\  -{{{\\frac{1}{\\sqrt{{\\mu_0}}}}} {{\\frac{1}{\\sqrt{\\rho}}}}} \\\\  -{\\frac{{ B} ^z}{{ B} ^y}} \\\\  1 \\\\  0\\end{matrix}\\right]$", outputtype="html", uid=142},
	{hidden=false, input="(A_expanded - eigLambdas[3] * Matrix.identity(7))():nullspace()", output="$\\left[\\begin{matrix}  0 \\\\  0 \\\\  -{\\frac{{ B} ^z}{{{{ B} ^y}} {{\\sqrt{{\\mu_0}}}} {{\\sqrt{\\rho}}}}} \\\\  {{\\frac{1}{\\sqrt{{\\mu_0}}}}} {{\\frac{1}{\\sqrt{\\rho}}}} \\\\  -{\\frac{{ B} ^z}{{ B} ^y}} \\\\  1 \\\\  0\\end{matrix}\\right]$", outputtype="html", uid=144},
	{hidden=false, input="-- ok now lets try the eigenmode trick ..\n-- dU/dt + F * dU/dx = 0\n-- so finding valid solutions of this is finding left-eigenvectors\n-- i.e. sums of du_i/dt + F * du_i/dx for conserved quantitiy u_i\n-- so for some w = sums of the conserved-quantity PDEs (which equal zero),\n-- find sums of w's such that l_i (du_i/dt + F du_i/dx) = 0 and l_i are our left-eigenvector components.\nWs = W7_dense()\nWt = Ws:diff(t)()\nWx = Ws:diff(x)()\nn = 7\neqns = range(n):mapi(|i| dt_W_eqns[i]:lhs())\n\n--[[ while we're here, subtract out vx from ll eigenvalues, aka subtract vx d/dx W from all modes. \n-- can we do this?\nfor i=1,7 do\n\9eqns[i] = (eqns[i]:clone() - v'^x' * Wx[i][1]):simplifyAddMulDiv()\nend\n--]]\nrho_mode, vx_mode, vy_mode, vz_mode, By_mode, Bz_mode, P_mode = eqns:unpack()\n\nP_mode = P_mode:subst((Cs_def^2 * rho)():switch())\n\nprint(W:diff(t):eq(Wt:T()))\nprint(W:diff(x):eq(Wx:T()))\nprint(rho_mode)\nprint(vx_mode)\nprint(vy_mode)\nprint(vz_mode)\nprint(By_mode)\nprint(Bz_mode)\nprint(P_mode)\n;", output="${\\frac{\\partial W}{\\partial t}} = {\\left[\\begin{matrix}  \\frac{\\partial \\rho}{\\partial t} &amp;  \\frac{\\partial { v} ^x}{\\partial t} &amp;  \\frac{\\partial { v} ^y}{\\partial t} &amp;  \\frac{\\partial { v} ^z}{\\partial t} &amp;  \\frac{\\partial { B} ^y}{\\partial t} &amp;  \\frac{\\partial { B} ^z}{\\partial t} &amp;  \\frac{\\partial P}{\\partial t}\\end{matrix}\\right]}$<br>\n${\\frac{\\partial W}{\\partial x}} = {\\left[\\begin{matrix}  \\frac{\\partial \\rho}{\\partial x} &amp;  \\frac{\\partial { v} ^x}{\\partial x} &amp;  \\frac{\\partial { v} ^y}{\\partial x} &amp;  \\frac{\\partial { v} ^z}{\\partial x} &amp;  \\frac{\\partial { B} ^y}{\\partial x} &amp;  \\frac{\\partial { B} ^z}{\\partial x} &amp;  \\frac{\\partial P}{\\partial x}\\end{matrix}\\right]}$<br>\n${\\frac{\\partial \\rho}{\\partial t}} + {{{\\rho}} \\cdot {{\\frac{\\partial { v} ^x}{\\partial x}}}} + {{{{ v} ^x}} {{\\frac{\\partial \\rho}{\\partial x}}}}$<br>\n${{{\\frac{\\partial P}{\\partial x}}} {{\\frac{1}{\\rho}}}} + {{{{ B} ^y}} {{\\frac{\\partial { B} ^y}{\\partial x}}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {{{{ B} ^z}} {{\\frac{\\partial { B} ^z}{\\partial x}}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {\\frac{\\partial { v} ^x}{\\partial t}} + {{{{ v} ^x}} {{\\frac{\\partial { v} ^x}{\\partial x}}}}$<br>\n${{{-1}} {{{ B} ^x}} {{\\frac{\\partial { B} ^y}{\\partial x}}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {\\frac{\\partial { v} ^y}{\\partial t}} + {{{{ v} ^x}} {{\\frac{\\partial { v} ^y}{\\partial x}}}}$<br>\n${{{-1}} {{{ B} ^x}} {{\\frac{\\partial { B} ^z}{\\partial x}}} {{\\frac{1}{{\\mu_0}}}} {{\\frac{1}{\\rho}}}} + {\\frac{\\partial { v} ^z}{\\partial t}} + {{{{ v} ^x}} {{\\frac{\\partial { v} ^z}{\\partial x}}}}$<br>\n${\\frac{\\partial { B} ^y}{\\partial t}} + {{{-1}} {{{ B} ^x}} {{\\frac{\\partial { v} ^y}{\\partial x}}}} + {{{{ B} ^y}} {{\\frac{\\partial { v} ^x}{\\partial x}}}} + {{{{ v} ^x}} {{\\frac{\\partial { B} ^y}{\\partial x}}}}$<br>\n${\\frac{\\partial { B} ^z}{\\partial t}} + {{{-1}} {{{ B} ^x}} {{\\frac{\\partial { v} ^z}{\\partial x}}}} + {{{{ B} ^z}} {{\\frac{\\partial { v} ^x}{\\partial x}}}} + {{{{ v} ^x}} {{\\frac{\\partial { B} ^z}{\\partial x}}}}$<br>\n${\\frac{\\partial P}{\\partial t}} + {{{{ v} ^x}} {{\\frac{\\partial P}{\\partial x}}}} + {{{\\frac{\\partial { v} ^x}{\\partial x}}} {{{{\\rho}} \\cdot {{{{c_s}}^{2}}}}}}$<br>\n", outputtype="html", uid=134},
	{hidden=false, input="allLeftVectors = table()\nallEigenvalues = table()", output="table: 0x7b62fe91d0f8", outputtype="html", uid=136},
	{hidden=false, input="function getTAndXCoeffs(expr)\n\9local coeffs, extra = factorLinearSystem({expr}, table():append(Wt:T()[1], Wx:T()[1]))\n\9local ts = range(n):mapi(function(i) return coeffs[1][i] end)\n\9local xs = range(n):mapi(function(i) return coeffs[1][n+i] end)\n\9return ts, xs, extra[1][1]\nend\nfunction getTCoeffs(expr)\n\9return (select(1,getXAndTCoeffs(expr)))\nend\nfunction getXCoeffs(expr)\n\9return (select(2,getXAndTCoeffs(expr)))\nend\nfunction verifyMode(expr)\n\9expr = expr:simplifyAddMulDiv()\n\9local tcoeffs, xcoeffs, extra = getTAndXCoeffs(expr)\n\9local ratios = range(n):mapi(function(i)\n\9\9return (xcoeffs[i] / tcoeffs[i])()\n\9end)\n\n\9local indexes = table()\9\9-- all valid indexes for U_,t\n\9local nonindexes = table()\9-- all the other indexes. make sure no U_,x's exist here\n\9for i,tc in ipairs(tcoeffs) do\n\9\9if Constant.isValue(tc, 0) then\n\9\9\9nonindexes:insert(i)\n\9\9else\n\9\9\9indexes:insert(i)\n\9\9end\n\9end\n\n\9-- make sure there are no non-t's in the x's\n\9for _,i in ipairs(nonindexes) do\n\9\9if not Constant.isValue(xcoeffs[i], 0) then\n\9\9\9print(Matrix{var'var', var'tcoeffs', var'xcoeffs', var'ratios'}:T():eq(Matrix(Ws:T()[1], tcoeffs, xcoeffs, ratios)))\n\9\9\9print(\"var \"..Ws[i][1]..\" got an x coefficient \"..xcoeffs[i]..\" that didn't have a t coefficient\")\n\9\9\9return\n\9\9end \n\9end\n\9assert(#indexes > 0, \"this expression had no U_,t's in it\")\n\9local ratio\n\9for _,i in ipairs(indexes) do\n\9\9local ratio2 = ratios[i]\n\9\9if not ratio then\n\9\9\9ratio = ratio2\n\9\9elseif Constant.isValue((ratio - ratio2)(), 0) then\n\9\9\9if ratio2:countNodes() < ratio:countNodes() then\n\9\9\9\9ratio = ratio2\n\9\9\9end\n\9\9else\n\9\9\9print(Matrix{var'var', var'tcoeffs', var'xcoeffs', var'ratios'}:T():eq(Matrix(Ws:T()[1], tcoeffs, xcoeffs, ratios)))\n\9\9\9print(\"var \"..Ws[i][1]..\" ratios of W_,x / W_,t = \"..ratio2..\" didn't match previous ratio \"..ratio)\n\9\9\9return\n\9\9end\n\9end\n\9-- TODO return an Array, and TODO make single-degree Array's print as rows instead of columns\n\9print(Matrix(tcoeffs), 'has eigenvalue', ratio)\n\9if not Constant.isValue(extra, 0) then\n\9\9print('!!! there was an extra term:', extra)\n\9end\n\9-- and ratio is the eigenvalue\n\9allLeftVectors:insert(tcoeffs)\n\9allEigenvalues:insert(ratio)\nend", output="", outputtype="html", uid=135},
	{hidden=false, input="sgnBx = var'sgn(B^x)'\nbetaY = B'^y' / sqrt(B'^y'^2 + B'^z'^2)\nbetaZ = B'^z' / sqrt(B'^z'^2 + B'^z'^2)", output="${sgn(B^x)}$", outputtype="html", uid=138},
	{hidden=false, input="'<hr>modes...'", output="<hr>modes...", outputtype="html", uid=139},
	{hidden=false, input="verifyMode(rho_mode - P_mode / Cs^2)", output="$\\left[\\begin{matrix}  1 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  0 &amp;  -{\\frac{1}{{{c_s}}^{2}}}\\end{matrix}\\right]$\9has eigenvalue\9${ v} ^x$<br>\n", outputtype="html", uid=140},
	{hidden=false, input="verifyMode(\n\9- vy_mode * betaZ * sqrt(mu_0) / 2\n\9+ vz_mode * betaY * sqrt(mu_0) / 2\n\9- By_mode * betaZ / (2 * sqrt(rho))\n\9+ Bz_mode * betaY / (2 * sqrt(rho))\n)", output="${\\left[\\begin{matrix}  var \\\\  tcoeffs \\\\  xcoeffs \\\\  ratios\\end{matrix}\\right]} = {\\left[\\begin{matrix}  \\rho &amp;  { v} ^x &amp;  { v} ^y &amp;  { v} ^z &amp;  { B} ^y &amp;  { B} ^z &amp;  P \\\\  0 &amp;  0 &amp;  -{\\frac{\\sqrt{{\\mu_0}}}{{{2}} {{\\sqrt{2}}}}} &amp;  \\frac{{{{ B} ^y}} {{\\sqrt{{\\mu_0}}}}}{{{2}} {{\\sqrt{{{{ B} ^y}^{2}} + {{{ B} ^z}^{2}}}}}} &amp;  -{\\frac{1}{{{2}} {{\\sqrt{2}}} {{\\sqrt{\\rho}}}}} &amp;  \\frac{{{{ B} ^y}} {{\\frac{1}{\\sqrt{{{{ B} ^y}^{2}} + {{{ B} ^z}^{2}}}}}}}{{{2}} {{\\sqrt{\\rho}}}} &amp;  0 \\\\  0 &amp;  \\frac{{{{ B} ^y}} {{\\left({{-{\\sqrt{{{{ B} ^y}^{2}} + {{{ B} ^z}^{2}}}}} + {{{{ B} ^z}} {{\\sqrt{2}}}}}\\right)}}}{{{2}} {{\\sqrt{2}}} {{\\sqrt{\\rho}}} {{\\sqrt{{{{ B} ^y}^{2}} + {{{ B} ^z}^{2}}}}}} &amp;  \\frac{{{ B} ^x}{-{{{{ v} ^x}} {{\\sqrt{{\\mu_0}}}} {{\\sqrt{\\rho}}}}}}{{{2}} {{\\sqrt{2}}} {{\\sqrt{\\rho}}}} &amp;  \\frac{{{{ B} ^y}} {{\\left({{-{{ B} ^x}} + {{{{ v} ^x}} {{\\sqrt{{\\mu_0}}}} {{\\sqrt{\\rho}}}}}\\right)}}}{{{2}} {{\\sqrt{\\rho}}} {{\\sqrt{{{{ B} ^y}^{2}} + {{{ B} ^z}^{2}}}}}} &amp;  \\frac{{{ B} ^x}{-{{{{ v} ^x}} {{\\sqrt{{\\mu_0}}}} {{\\sqrt{\\rho}}}}}}{{{\\rho}} \\cdot {{2}} {{\\sqrt{2}}} {{\\sqrt{{\\mu_0}}}}} &amp;  \\frac{{{{ B} ^y}} {{\\left({{-{{ B} ^x}} + {{{{ v} ^x}} {{\\sqrt{{\\mu_0}}}} {{\\sqrt{\\rho}}}}}\\right)}}}{{{2}} {{\\rho}} \\cdot {{\\sqrt{{\\mu_0}}}} {{\\sqrt{{{{ B} ^y}^{2}} + {{{ B} ^z}^{2}}}}}} &amp;  0 \\\\  ¿ &amp;  ¿ &amp;  {{ v} ^x}{-{{{{ B} ^x}} {{\\frac{1}{\\sqrt{{\\mu_0}}}}} {{\\frac{1}{\\sqrt{\\rho}}}}}} &amp;  \\frac{{{{ B} ^y}} {{\\left({{-{{ B} ^x}} + {{{{ v} ^x}} {{\\sqrt{{\\mu_0}}}} {{\\sqrt{\\rho}}}}}\\right)}}}{{{{ B} ^y}} {{\\sqrt{{\\mu_0}}}} {{\\sqrt{\\rho}}}} &amp;  {{ v} ^x}{-{{{{ B} ^x}} {{\\frac{1}{\\sqrt{{\\mu_0}}}}} {{\\frac{1}{\\sqrt{\\rho}}}}}} &amp;  \\frac{{{{ B} ^y}} {{\\left({{-{{ B} ^x}} + {{{{ v} ^x}} {{\\sqrt{{\\mu_0}}}} {{\\sqrt{\\rho}}}}}\\right)}}}{{{{ B} ^y}} {{\\sqrt{{\\mu_0}}}} {{\\sqrt{\\rho}}}} &amp;  ¿\\end{matrix}\\right]}$<br>\nvar ${ v} ^x$ got an x coefficient $\\frac{{{{ B} ^y}} {{\\left({{-{\\sqrt{{{{ B} ^y}^{2}} + {{{ B} ^z}^{2}}}}} + {{{{ B} ^z}} {{\\sqrt{2}}}}}\\right)}}}{{{2}} {{\\sqrt{2}}} {{\\sqrt{\\rho}}} {{\\sqrt{{{{ B} ^y}^{2}} + {{{ B} ^z}^{2}}}}}}$ that didn't have a t coefficient<br>\n", outputtype="html", uid=137},
	{hidden=false, input="\nprint'eigenvalues and left-eigenvectors:'\nfor i=1,#allLeftVectors do\n\9print(allEigenvalues[i], ':', allLeftVectors[i])\nend\n;", output="", outputtype="html", uid=141},
	{hidden=false, input="-- eig = A_expanded():eigen{lambdaVar=lambda, lambdas=eigLambdas, dontCalcL=true}", output="", outputtype="html", uid=133},
	{hidden=false, input="-- print(eig.R * eig.Lambda * eig.L)", output="", outputtype="html", uid=113},
	{hidden=false, input="-- A_expanded:inv() -- this fails as well, , because without the velocity diagonal, the 1st col/row is zeroes, \n-- so its degenerate\n-- but not being invertible is fine, it just means a few degrees of freedom of the eigensystem are arbitrary\n-- same with the eigensystem being degenerate I guess, just have to pick some basis vectors.", output="", outputtype="html", uid=121},
	{hidden=false, input="", output="", outputtype="html", uid=120}
}